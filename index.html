<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&family=Cinzel:wght@700;900&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PowerMatch â€“ Live Sales Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --bg: #0D0D17; --card: #1B1A30; --card-border: rgba(130,252,224,0.12);
    --text: #F5F5F5; --dim: #A499E2; --dimmer: #757FBF;
    --red: #A72444; --yellow: #DC7243; --green: #82FCE0; --gold: #DC7243;
    --blue: #63AEFA; --pink: #A72444; --mint: #82FCE0;
    --accent: #6C2BF7; --glass: rgba(27,26,48,0.85);
    --cyan: #82FCE0; --purple: #6C2BF7; --lightblue: #78D0F7;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Inter', 'Segoe UI', system-ui, sans-serif; background: #0D0D17; color: var(--text);
    padding: 16px 20px; min-height: 100vh; position: relative; overflow-x: hidden;
  }
  /* â”€â”€ Cycling background system â”€â”€ */
  .bg-cycle-layer {
    position: fixed; inset: 0; z-index: -3;
    background-size: cover; background-position: center;
    transition: opacity 3s ease-in-out;
    will-change: opacity;
  }
  .bg-cycle-layer.active { opacity: 1; }
  .bg-cycle-layer.inactive { opacity: 0; }
  /* Dark overlay on bg image â€” lower opacity so background SHOWS */
  body::before {
    content: ''; position: fixed; inset: 0; z-index: -2;
    background: rgba(13,13,23,0.62);
    pointer-events: none;
  }
  /* HUD grid overlay â€” subtle futuristic scanline feel */
  body::after {
    content: ''; position: fixed; inset: 0; z-index: -1;
    background:
      repeating-linear-gradient(0deg, transparent, transparent 59px, rgba(130,252,224,0.03) 60px),
      repeating-linear-gradient(90deg, transparent, transparent 59px, rgba(130,252,224,0.03) 60px);
    pointer-events: none;
  }
  /* â”€â”€ Splash preloader (prevents glitch on TV stick) â”€â”€ */
  #splash-preloader {
    position: fixed; inset: 0; z-index: 99999; background: #0D0D17;
    display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 24px;
  }
  #splash-preloader .splash-logo {
    font-family: 'Inter', sans-serif; font-weight: 900; font-size: 42px;
    background: linear-gradient(135deg, #82FCE0 0%, #63AEFA 50%, #6C2BF7 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  #splash-preloader .splash-spinner {
    width: 36px; height: 36px; border: 3px solid rgba(130,252,224,0.2);
    border-top-color: #82FCE0; border-radius: 50%;
    animation: splash-spin 0.8s linear infinite;
  }
  @keyframes splash-spin { to { transform: rotate(360deg); } }
  #splash-preloader.fade-out {
    opacity: 0; transition: opacity 0.5s ease; pointer-events: none;
  }
  #app { position: relative; z-index: 1; }

  /* â”€â”€ Header â”€â”€ */
  .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
  h1 {
    font-size: 22px; font-weight: 900; letter-spacing: 2px;
    background: linear-gradient(135deg, #82FCE0 0%, #63AEFA 40%, #6C2BF7 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    text-shadow: none;
  }
  .subtitle {
    font-size: 12px; color: var(--dim); margin-top: 3px;
    display: flex; align-items: center; gap: 6px;
  }
  .live-dot {
    width: 8px; height: 8px; border-radius: 50%; background: #34D399;
    box-shadow: 0 0 8px rgba(52,211,153,0.8), 0 0 16px rgba(52,211,153,0.4);
    animation: livePulse 2s ease-in-out infinite;
    display: inline-block;
  }
  @keyframes livePulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 8px rgba(52,211,153,0.8); }
    50% { opacity: 0.5; box-shadow: 0 0 16px rgba(52,211,153,1), 0 0 32px rgba(52,211,153,0.4); }
  }
  .refresh-btn {
    background: #1B1A30; border: 1px solid var(--card-border); border-radius: 8px;
    color: var(--dim); font-size: 11px; padding: 7px 14px; cursor: pointer; transition: all 0.15s;
  }
  .refresh-btn:hover { background: #292948; color: #fff; }
  .last-updated { font-size: 10px; color: var(--dimmer); margin-top: 4px; text-align: right; }

  /* â”€â”€ Tabs â”€â”€ */
  .tab-nav {
    display: flex; gap: 3px; margin-bottom: 14px;
    background: rgba(27,26,48,0.9); border: 1px solid var(--card-border); border-radius: 10px; padding: 4px;
    width: fit-content;
    box-shadow: 0 4px 16px rgba(0,0,0,0.4), 0 0 20px rgba(108,43,247,0.06);
  }
  .tab-btn {
    background: transparent; border: none; border-radius: 7px;
    color: var(--dim); font-size: 12px; font-weight: 700; padding: 7px 20px; cursor: pointer;
    transition: all 0.15s; letter-spacing: 0.5px; text-transform: uppercase;
  }
  .tab-btn:hover { color: var(--text); background: #292948; }
  .tab-btn.active {
    background: linear-gradient(135deg, #6C2BF7, #63AEFA); color: #fff;
    box-shadow: 0 0 20px rgba(99,174,250,0.4), 0 0 40px rgba(108,43,247,0.2);
  }

  /* â”€â”€ Pickers â”€â”€ */
  .picker-row { display: flex; gap: 8px; margin-bottom: 12px; align-items: center; flex-wrap: wrap; }
  .picker-row label { font-size: 12px; color: var(--dim); font-weight: 600; }
  .picker-row select {
    background: #1B1A30; border: 1px solid var(--card-border); border-radius: 8px;
    color: var(--text); font-size: 12px; padding: 6px 12px; cursor: pointer;
  }

  /* â”€â”€ Loading / Error â”€â”€ */
  #loading { display: flex; align-items: center; justify-content: center; height: 200px; flex-direction: column; gap: 12px; }
  .spinner { width: 28px; height: 28px; border: 3px solid var(--card-border); border-top-color: var(--cyan); border-radius: 50%; animation: spin 0.7s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
  #error-msg { color: #DC7243; font-size: 13px; display: none; }

  /* â”€â”€ Section titles â€” neon glow â”€â”€ */
  .section-title {
    font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 3px;
    color: var(--cyan); margin: 16px 0 10px;
    text-shadow: 0 0 10px rgba(130,252,224,0.5), 0 0 30px rgba(130,252,224,0.2);
  }

  /* â”€â”€ Cards â€” premium depth + glow â”€â”€ */
  .card {
    background: linear-gradient(135deg, #1B1A30 0%, #272745 100%);
    border: 1px solid var(--card-border); border-radius: 14px; padding: 18px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5), 0 0 30px rgba(108,43,247,0.08), inset 0 1px 0 rgba(130,252,224,0.06);
    border-top: 2px solid rgba(130,252,224,0.2);
  }
  .card-title { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--dim); margin-bottom: 14px; }

  /* â”€â”€ Grids â”€â”€ */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

  /* â”€â”€ KPI badges â”€â”€ */
  .kpi-row { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; }
  .kpi-card {
    flex: 1; min-width: 100px;
    background: linear-gradient(135deg, #1B1A30 0%, #272745 100%);
    border: 1px solid var(--card-border); border-radius: 12px; padding: 14px; text-align: center;
    border-left: 3px solid rgba(99,174,250,0.4);
    box-shadow: 0 4px 16px rgba(0,0,0,0.4), 0 0 20px rgba(99,174,250,0.06);
  }
  .kpi-label { font-size: 10px; color: var(--dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
  .kpi-val {
    font-size: 26px; font-weight: 900; line-height: 1; margin-bottom: 3px;
    background: linear-gradient(135deg, #F5F5F5, #82FCE0);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  }
  .kpi-sub { font-size: 11px; color: var(--dim); }
  .kpi-idx { font-size: 12px; font-weight: 700; margin-top: 5px; }

  /* â”€â”€ Badges (0-65 red, 66-99 yellow, 100+ green) â”€â”€ */
  .badge { font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 20px; white-space: nowrap; }
  .badge-red    { background: rgba(167,36,68,0.25); color: #ff6b6b; }
  .badge-yellow { background: rgba(220,114,67,0.25); color: #fbbf24; }
  .badge-green  { background: rgba(130,252,224,0.15); color: var(--cyan); }
  .badge-gold   { background: linear-gradient(135deg, rgba(130,252,224,0.25), rgba(99,174,250,0.15)); color: #82FCE0; border: 1px solid rgba(130,252,224,0.4); }

  .delta-pos { color: var(--cyan); font-size: 11px; }
  .delta-neg { color: #DC7243; font-size: 11px; }
  .delta-neu { color: var(--dim); font-size: 11px; }
  .divider { border: none; border-top: 1px solid var(--card-border); margin: 10px 0; }

  /* â”€â”€ Seller cards â”€â”€ */
  .seller-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px; }
  .seller-card {
    background: linear-gradient(160deg, #1B1A30 0%, #272745 100%);
    border: 1px solid var(--card-border); border-radius: 12px; padding: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4), 0 0 20px rgba(108,43,247,0.06);
    border-top: 2px solid rgba(130,252,224,0.2);
  }
  .seller-name {
    font-size: 14px; font-weight: 800; color: #fff; margin-bottom: 10px; padding-bottom: 8px;
    border-bottom: 1px solid rgba(130,252,224,0.12);
    text-shadow: 0 0 15px currentColor;
  }
  .seller-kpi { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
  .seller-kpi-label { font-size: 11px; color: var(--dim); }
  .seller-kpi-right { display: flex; align-items: center; gap: 6px; }
  .seller-kpi-val { font-size: 12px; font-weight: 700; color: #fff; }

  /* â”€â”€ MiM table â”€â”€ */
  .mim-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-top: 14px; }
  .mim-table { width: 100%; border-collapse: collapse; font-size: 11px; }
  .mim-table th { text-align: left; color: var(--dim); font-weight: 600; padding: 5px 6px; border-bottom: 1px solid var(--card-border); }
  .mim-table td { padding: 6px 6px; border-bottom: 1px solid #272745; color: var(--text); }
  .mim-table tr:hover td { background: #272745; }
  .tag-low { color: var(--yellow); font-size: 10px; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DAGLIG DASHBOARD
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .daily-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; margin-bottom: 14px; }
  .daily-card {
    background: linear-gradient(160deg, #1B1A30 0%, #272745 50%, #1B1A30 100%);
    border: 1px solid var(--card-border); border-radius: 16px;
    padding: 20px 18px 16px; text-align: center; position: relative; overflow: hidden;
    transition: border-color 0.3s, box-shadow 0.3s;
    box-shadow: 0 8px 32px rgba(0,0,0,0.6), 0 0 40px rgba(108,43,247,0.08);
    border-top: 2px solid rgba(99,174,250,0.25);
  }
  .daily-card.state-gold {
    border-color: rgba(130,252,224,0.5);
    border-top: 2px solid rgba(130,252,224,0.6);
    box-shadow: 0 0 50px rgba(130,252,224,0.2), 0 0 80px rgba(130,252,224,0.08), 0 8px 32px rgba(0,0,0,0.6);
  }
  .daily-card.state-gold::before {
    content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px;
    border-radius: 16px; background: linear-gradient(135deg, rgba(130,252,224,0.15), transparent 40%, rgba(99,174,250,0.10));
    z-index: 0; animation: goldShimmer 3s ease-in-out infinite;
  }
  @keyframes goldShimmer { 0%,100%{opacity:.5} 50%{opacity:1} }
  .daily-card > * { position: relative; z-index: 1; }

  .daily-name {
    font-size: 18px; font-weight: 900; color: #fff; margin-bottom: 12px; letter-spacing: 1px;
    text-shadow: 0 0 20px currentColor, 0 0 40px rgba(255,255,255,0.1);
  }

  /* Big ring â€” compact for TV */
  .ring-wrap { position: relative; width: 180px; height: 180px; margin: 0 auto 12px; }
  .ring-wrap svg { width: 180px; height: 180px; transform: rotate(-90deg); }
  .ring-bg { fill: none; stroke: #3a3a5c; stroke-width: 10; }
  .ring-fg {
    fill: none; stroke-width: 12; stroke-linecap: round;
    transition: stroke-dashoffset 1s ease, stroke 0.5s;
    /* Glow moved to inline SVG filter â€” CSS drop-shadow creates rectangular artifacts on Mali-G31 */
  }
  .ring-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); text-align: center; }
  .ring-pct {
    font-size: 42px; font-weight: 900; line-height: 1; font-variant-numeric: tabular-nums;
    text-shadow: 0 0 20px currentColor, 0 0 40px rgba(255,255,255,0.15);
  }
  .ring-label { font-size: 11px; color: var(--dim); margin-top: 4px; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 700; }

  /* Small ring for team donuts */
  .ring-sm { position: relative; width: 140px; height: 140px; margin: 0 auto 8px; }
  .ring-sm svg { width: 140px; height: 140px; transform: rotate(-90deg); }
  .ring-sm .ring-pct {
    font-size: 36px; font-weight: 900; font-variant-numeric: tabular-nums;
    text-shadow: 0 0 15px currentColor;
  }
  .ring-sm .ring-label { font-size: 12px; font-weight: 700; letter-spacing: 1px; }

  /* Progress bars â€” bolder for TV readability */
  .daily-bars { text-align: left; margin-top: 4px; }
  .bar-row { margin-bottom: 10px; }
  .bar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
  .bar-label { font-size: 14px; font-weight: 800; color: #E8E5F8; }
  .bar-val { font-size: 15px; font-weight: 900; color: #fff; font-variant-numeric: tabular-nums; }
  .bar-pct { font-size: 14px; font-weight: 900; margin-left: 6px; }
  .bar-track { height: 12px; background: #3a3a5c; border-radius: 6px; overflow: hidden; position: relative; }
  .bar-fill { height: 100%; border-radius: 6px; transition: width 0.8s ease; min-width: 2px; }
  .bar-fill.c-red    { background: linear-gradient(90deg, #dc2626, #ef4444); box-shadow: 0 0 14px rgba(239,68,68,0.5); }
  .bar-fill.c-yellow { background: linear-gradient(90deg, #d97706, #fbbf24); box-shadow: 0 0 14px rgba(251,191,36,0.5); }
  .bar-fill.c-green  { background: linear-gradient(90deg, #059669, #34D399); box-shadow: 0 0 14px rgba(52,211,153,0.5); }
  .bar-fill.c-gold   {
    background: linear-gradient(90deg, #34D399, #82FCE0);
    box-shadow: 0 0 20px rgba(130,252,224,0.6), 0 0 40px rgba(130,252,224,0.2);
    animation: barGoldPulse 2s ease-in-out infinite;
  }
  @keyframes barGoldPulse { 0%,100%{box-shadow:0 0 10px rgba(130,252,224,0.3)} 50%{box-shadow:0 0 20px rgba(130,252,224,0.6)} }

  /* Team donuts row */
  .daily-team-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; margin-bottom: 14px; }
  .daily-team-card {
    background: linear-gradient(160deg, #1B1A30 0%, #272745 100%);
    border: 1px solid var(--card-border); border-radius: 14px;
    padding: 18px; text-align: center;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5), 0 0 30px rgba(99,174,250,0.06);
    border-top: 2px solid rgba(99,174,250,0.25);
  }
  .daily-team-card-title {
    font-size: 14px; font-weight: 900; text-transform: uppercase; letter-spacing: 3px;
    color: var(--cyan); margin-bottom: 10px;
    text-shadow: 0 0 10px rgba(130,252,224,0.4);
  }

  /* Comparison table */
  .compare-table { width: 100%; border-collapse: collapse; font-size: 12px; }
  .compare-table th {
    text-align: center; color: var(--dim); font-weight: 700; padding: 10px 8px;
    border-bottom: 2px solid var(--card-border); font-size: 10px; text-transform: uppercase; letter-spacing: 1px;
  }
  .compare-table th:first-child { text-align: left; }
  .compare-table td { padding: 12px 8px; border-bottom: 1px solid #272745; text-align: center; }
  .compare-table td:first-child { text-align: left; font-weight: 700; color: var(--dim); font-size: 11px; }
  .compare-table tr:hover td { background: #272745; }
  .compare-val { font-size: 18px; font-weight: 900; color: #fff; }
  .compare-target { font-size: 10px; color: var(--dimmer); margin-top: 1px; }
  .compare-bar-wrap { width: 100%; margin-top: 4px; }
  .compare-bar-track { height: 4px; background: #3a3a5c; border-radius: 2px; overflow: hidden; }
  .compare-bar-fill { height: 100%; border-radius: 2px; transition: width 0.6s ease; }
  .compare-bar-fill.c-red    { background: linear-gradient(90deg, #dc2626, #ef4444); }
  .compare-bar-fill.c-yellow { background: linear-gradient(90deg, #d97706, #fbbf24); }
  .compare-bar-fill.c-green  { background: linear-gradient(90deg, #059669, #34D399); }
  .compare-bar-fill.c-gold   { background: linear-gradient(90deg, #34D399, #82FCE0); }

  /* â”€â”€ Person dashboard â”€â”€ */
  .person-hero {
    background: linear-gradient(135deg, var(--card) 0%, #1a1e2e 100%);
    border: 1px solid var(--card-border); border-radius: 14px; padding: 24px;
    margin-bottom: 20px; display: flex; align-items: center; gap: 20px;
  }
  .person-avatar {
    width: 54px; height: 54px; border-radius: 50%; display: flex; align-items: center;
    justify-content: center; font-size: 20px; font-weight: 900; flex-shrink: 0;
  }
  .person-hero-name { font-size: 22px; font-weight: 900; }
  .person-hero-sub { font-size: 12px; color: var(--dim); margin-top: 3px; }

  .week-table { width: 100%; border-collapse: collapse; font-size: 12px; }
  .week-table th { text-align: center; color: var(--dim); font-weight: 700; padding: 7px 8px; border-bottom: 1px solid var(--card-border); font-size: 10px; text-transform: uppercase; letter-spacing: 0.8px; }
  .week-table td { padding: 8px 8px; border-bottom: 1px solid #151825; text-align: center; }
  .week-table td:first-child { text-align: left; font-weight: 700; color: #94a3b8; }
  .week-table tr:hover td { background: #1a1e2e; }

  .red { color: var(--red); } .yellow { color: var(--yellow); } .green { color: var(--green); } .gold { color: var(--gold); }

  /* â”€â”€ No-data message â”€â”€ */
  .no-data { color: var(--dim); font-size: 13px; text-align: center; padding: 40px; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MIM CELEBRATION SYSTEM - WORLD CLASS REDESIGN
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */


  @keyframes avatarBounce {
    0% { opacity: 0; transform: scale(0); }
    70% { transform: scale(1.1); }
    100% { opacity: 1; transform: scale(1); }
  }

  @keyframes avatarShine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  @keyframes cardSlideUp {
    0% { opacity: 0; transform: translateY(30px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  @keyframes titleScaleIn {
    0% { opacity: 0; transform: scale(0.5); }
    100% { opacity: 1; transform: scale(1); }
  }

  /* === CELEBRATION OVERLAY (matches celebration_test.html) === */
  #mim-celebration-overlay {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 9999;
    background: #000;
    display: none;
    align-items: center; justify-content: center;
    opacity: 0; transition: opacity 1.5s ease;
    overflow: hidden;
  }
  #mim-celebration-overlay.active {
    display: flex; opacity: 1;
  }
  #celebration-bg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
    background-color: #000; overflow: hidden;
  }
  #celebration-bg video {
    position: absolute; top: 50%; left: 50%;
    min-width: 100%; min-height: 100%;
    transform: translate(-50%, -50%);
    object-fit: cover;
  }
  .celebration-content {
    position: relative; z-index: 2;
    display: flex; flex-direction: column; align-items: center;
    justify-content: center;
    width: 100vw; height: 100vh;
  }

  /* Title section */
  .cel-title-section { text-align: center; margin-bottom: 30px; }
  .cel-title {
    font-family: 'Cinzel', serif;
    font-size: 52px; font-weight: 900; color: #ffd700;
    -webkit-text-stroke: 1.5px rgba(0,0,0,0.4);
    text-shadow: 0 0 20px rgba(255,215,0,0.8), 0 0 40px rgba(255,215,0,0.4), 0 2px 8px rgba(0,0,0,0.6);
    letter-spacing: 6px; text-transform: uppercase; margin-bottom: 6px;
  }
  .cel-combo {
    font-family: 'Cinzel', serif;
    font-size: 24px; font-weight: 900; color: #ffd700;
    -webkit-text-stroke: 1px rgba(0,0,0,0.4);
    text-shadow: 0 0 20px rgba(255,215,0,0.8), 0 2px 6px rgba(0,0,0,0.8);
    letter-spacing: 4px;
    opacity: 0;
  }
  .cel-combo.show { animation: celComboPop 0.6s ease-out forwards; }
  @keyframes celComboPop {
    0% { opacity: 0; transform: scale(2); }
    60% { opacity: 1; transform: scale(0.9); }
    100% { opacity: 1; transform: scale(1); }
  }

  /* People row â€” two avatars side by side */
  .cel-people-row {
    display: flex; align-items: center; justify-content: center; gap: 80px;
  }
  .cel-person {
    display: flex; flex-direction: column; align-items: center;
    opacity: 0; transform: scale(0.8) translateY(20px);
  }
  .cel-person.animate-in { animation: celPersonReveal 1s ease-out forwards; }
  @keyframes celPersonReveal {
    0% { opacity: 0; transform: scale(0.8) translateY(20px); }
    100% { opacity: 1; transform: scale(1) translateY(0); }
  }

  /* Avatar rings */
  .cel-avatar-ring {
    width: 260px; height: 260px; border-radius: 50%;
    padding: 5px; margin-bottom: 16px; position: relative;
  }
  .cel-avatar-ring.closer {
    background: linear-gradient(135deg, #ffd700, #ff8c00, #ffd700);
    box-shadow: 0 0 30px rgba(255,215,0,0.6), 0 0 60px rgba(255,165,0,0.3);
  }
  .cel-avatar-ring.screener {
    background: linear-gradient(135deg, #ffd700, #ff8c00, #ffd700);
    box-shadow: 0 0 30px rgba(255,215,0,0.6), 0 0 60px rgba(255,165,0,0.3);
  }
  .cel-avatar-ring img {
    width: 115%; height: 115%; border-radius: 50%; object-fit: cover; display: block;
    margin: -7.5% 0 0 -7.5%; object-position: top center;
  }
  .cel-avatar-fallback {
    width: 100%; height: 100%; border-radius: 50%;
    background: rgba(0,0,0,0.5);
    display: flex; align-items: center; justify-content: center;
    font-size: 80px; font-weight: 900; color: #ffd700;
    font-family: 'Cinzel', serif;
  }

  /* Person name */
  .cel-person-name {
    font-family: 'Cinzel', serif;
    font-size: 32px; font-weight: 700; color: #ffd700;
    margin-top: 8px;
    -webkit-text-stroke: 1px rgba(0,0,0,0.5);
    text-shadow: 0 0 15px rgba(255,215,0,0.6), 0 2px 6px rgba(0,0,0,0.8);
  }

  /* Deal card */
  .cel-deal-card {
    margin-top: 24px; padding: 18px 50px;
    background: rgba(0,0,0,0.65);
    border: 1px solid rgba(255,215,0,0.4);
    border-radius: 14px; text-align: center;
    opacity: 0;
  }
  .cel-deal-card.show { animation: celCardSlideUp 0.8s ease-out forwards; }
  @keyframes celCardSlideUp {
    0% { opacity: 0; transform: translateY(20px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  .cel-deal-kandidat { font-size: 22px; font-weight: 700; color: #ffd700; margin-bottom: 2px; }
  .cel-deal-virksomhed { font-size: 22px; font-weight: 700; color: #ffd700; margin-bottom: 8px; }
  .cel-deal-stats { display: flex; gap: 30px; justify-content: center; align-items: center; }
  .cel-stat { text-align: center; }
  .cel-stat-value { font-size: 26px; font-weight: 700; color: #ffd700; display: block; }
  .cel-stat-label { font-size: 11px; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 1px; }
  .cel-stat-divider { width: 1px; height: 40px; background: rgba(255,215,0,0.3); }

  /* TV mode (1200px+) */
  @media (min-width: 1200px) {
    .cel-title { font-size: 64px; letter-spacing: 8px; }
    .cel-combo { font-size: 30px; }
    .cel-avatar-ring { width: 300px; height: 300px; }
    .cel-person-name { font-size: 38px; }
    .cel-people-row { gap: 120px; }
    .cel-deal-card { padding: 22px 70px; }
    .cel-deal-kandidat { font-size: 26px; }
    .cel-deal-virksomhed { font-size: 26px; }
    .cel-stat-value { font-size: 30px; }
  }


  /* Sound toggle button */
  .sound-toggle {
    position: fixed; bottom: 20px; right: 20px; z-index: 10001;
    background: var(--card); border: 1px solid var(--card-border);
    border-radius: 50%; width: 44px; height: 44px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: all 0.2s; font-size: 20px;
  }
  .sound-toggle:hover {
    background: #1e2236; border-color: var(--blue);
  }
  .sound-toggle.muted { opacity: 0.5; }

  /* Hall of Fame */
  .mim-log-section {
    background: linear-gradient(160deg, #1B1A30 0%, #272745 100%);
    border: 1px solid var(--card-border); border-radius: 12px;
    padding: 16px; margin-bottom: 16px; max-height: 200px; overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    border-top: 2px solid rgba(130,252,224,0.2);
  }

  .mim-log-title {
    font-size: 14px; font-weight: 700; color: var(--cyan); margin-bottom: 16px;
    text-shadow: 0 0 10px rgba(130,252,224,0.4);
  }

  .mim-log-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 8px;
  }

  .mim-log-card {
    background: #272745; border: 1px solid var(--card-border); border-radius: 8px;
    padding: 8px 10px; display: flex; flex-direction: column; gap: 4px;
  }

  .mim-log-time {
    font-size: 10px; color: var(--dim); text-transform: uppercase; letter-spacing: 0.5px;
  }

  .mim-log-seller {
    font-size: 12px; font-weight: 700;
  }

  .mim-log-candidate {
    font-size: 11px; color: #94a3b8;
  }

  .mim-log-company {
    font-size: 11px; color: #94a3b8;
  }

  .mim-log-meta {
    display: flex; gap: 8px; flex-wrap: wrap; align-items: center;
    font-size: 10px; color: var(--dim);
  }

  .mim-log-tag {
    background: #151825; border: 1px solid var(--card-border); border-radius: 4px;
    padding: 2px 6px; font-size: 9px; font-weight: 600;
  }

  .mim-log-empty {
    color: var(--dim); font-size: 13px; text-align: center; padding: 40px 20px;
  }

  .pulse-dot {
    display: inline-block; width: 6px; height: 6px; border-radius: 50%;
    background: var(--cyan); animation: pulse 2s ease-in-out infinite;
    margin-right: 4px;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }


  /* Photo upload */
  .photo-upload-hint {
    position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.7);
    color: #fff; font-size: 9px; text-align: center; padding: 4px 0;
    opacity: 0; transition: opacity 0.2s; cursor: pointer; border-radius: 0 0 8px 8px;
  }
  .photo-upload-wrap:hover .photo-upload-hint { opacity: 1; }
  .photo-upload-wrap { position: relative; cursor: pointer; }
  .photo-settings-btn {
    background: var(--card); border: 1px solid var(--card-border); border-radius: 8px;
    color: #94a3b8; font-size: 11px; padding: 7px 14px; cursor: pointer; transition: all 0.15s;
    margin-left: 8px;
  }
  .photo-settings-btn:hover { background: #1e2236; color: #fff; }
  .photo-mgr { display: none; background: var(--card); border: 1px solid var(--card-border); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
  .photo-mgr.open { display: block; }
  .photo-mgr-grid { display: flex; gap: 24px; align-items: center; flex-wrap: wrap; }
  .photo-mgr-item { text-align: center; }
  .photo-mgr-avatar {
    width: 80px; height: 80px; border-radius: 50%; overflow: hidden; margin: 0 auto 8px;
    border: 3px solid var(--card-border); cursor: pointer; transition: border-color 0.2s;
    display: flex; align-items: center; justify-content: center; background: #1a1e2e;
  }
  .photo-mgr-avatar:hover { border-color: var(--blue); }
  .photo-mgr-avatar img { width: 100%; height: 100%; object-fit: cover; }
  .photo-mgr-name { font-size: 11px; font-weight: 700; color: #94a3b8; }
  .photo-mgr-action { font-size: 10px; color: var(--blue); cursor: pointer; margin-top: 2px; }
  .photo-mgr-action:hover { text-decoration: underline; }

  /* Test button */
  .test-celebration-btn {
    position: fixed; bottom: 70px; right: 20px; z-index: 10001;
    background: var(--blue); border: none;
    border-radius: 50%; width: 44px; height: 44px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: all 0.2s; font-size: 18px;
    color: #fff; font-weight: 700;
  }
  .test-celebration-btn:hover {
    background: #3b82f6; transform: scale(1.1);
  }

  @media (max-width: 900px) {
    .grid-2, .grid-3, .seller-grid, .mim-grid, .daily-grid { grid-template-columns: 1fr; }
    .kpi-row { flex-wrap: wrap; }
    body { padding: 16px; }
    .daily-team { flex-wrap: wrap; }
    .mim-log-grid { grid-template-columns: 1fr; }
    .cel-title { font-size: 40px; letter-spacing: 4px; }
    .cel-avatar-ring { width: 180px; height: 180px; }
    .cel-people-row { gap: 40px; }
    .cel-person-name { font-size: 24px; }
    .cel-combo { font-size: 20px; }
  }

  /* â•â•â• TV-OPTIMISED â€” No backdrop-filter anywhere, solid backgrounds â•â•â• */

  /* Card entrance animation */
  @keyframes cardFadeIn {
    0% { opacity: 0; transform: translateY(12px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  .daily-card { animation: cardFadeIn 0.6s ease-out both; }
  .daily-card:nth-child(1) { animation-delay: 0.1s; }
  .daily-card:nth-child(2) { animation-delay: 0.2s; }
  .daily-card:nth-child(3) { animation-delay: 0.3s; }
  .daily-team-card { animation: cardFadeIn 0.6s ease-out both; }
  .daily-team-card:nth-child(1) { animation-delay: 0.4s; }
  .daily-team-card:nth-child(2) { animation-delay: 0.5s; }
  .daily-team-card:nth-child(3) { animation-delay: 0.6s; }</style>
</head>
<body>
<!-- Cycling Deep Space backgrounds â€” two layers for crossfade -->
<div id="bg-a" class="bg-cycle-layer active" style="background-image:url('bg/5.jpg')"></div>
<div id="bg-b" class="bg-cycle-layer inactive"></div>
<!-- Splash preloader: covers screen until data is ready -->
<div id="splash-preloader">
  <div class="splash-logo">PowerMatch</div>
  <div class="splash-spinner"></div>
</div>
<div id="app">

<div class="header">
  <div>
    <h1>POWERMATCH â€” SALES DASHBOARD</h1>
    <div class="subtitle"><span class="live-dot"></span><span id="period-label"></span></div>
  </div>
  <div style="text-align:right;display:flex;align-items:center;gap:4px">
    <button class="photo-settings-btn" onclick="togglePhotoMgr()">ğŸ“· Fotos</button>
    <button class="refresh-btn" onclick="loadAll()">â†» Opdater</button>
    <div class="last-updated" id="last-updated"></div>
  </div>
</div>

<!-- Hidden file input for photo upload -->
<input type="file" id="photo-upload-input" accept="image/*" style="display:none" onchange="handlePhotoUpload(event)">

<!-- Photo Manager Panel -->
<div class="photo-mgr" id="photo-mgr">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
    <div style="font-size:13px;font-weight:700;color:#fff">SÃ¦lger-fotos</div>
    <div style="font-size:10px;color:var(--dim)">Klik pÃ¥ avatar for at uploade Â· Gemmes i browseren</div>
  </div>
  <div class="photo-mgr-grid" id="photo-mgr-grid"></div>
</div>

<div class="tab-nav">
  <button class="tab-btn active" id="tab-daglig" onclick="switchTab('daglig')">Daglig</button>
  <button class="tab-btn"        id="tab-uge"    onclick="switchTab('uge')">Uge</button>
  <button class="tab-btn"        id="tab-maaned" onclick="switchTab('maaned')">MÃ¥ned</button>
  <button class="tab-btn"        id="tab-person" onclick="switchTab('person')">Person</button>
</div>

<div id="loading" style="display:none"></div>
<div id="error-msg"></div>

<!-- â•â• DAGLIG VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="view-daglig" style="display:none">
  <div class="picker-row">
    <label>Dato:</label>
    <select id="day-select" onchange="renderDaglig()"></select>
  </div>

  <!-- Individual seller cards with big rings -->
  <div class="daily-grid" id="daily-cards"></div>

  <!-- Team donuts: KT, Samtaler, MiM -->
  <div class="section-title" style="font-size:13px;color:var(--lightblue);letter-spacing:3px">TEAM â€“ DAGENS TOTALER</div>
  <div class="daily-team-row" id="daily-team-donuts"></div>

  <!-- MiM Log moved to bottom -->
  <div class="mim-log-section" id="mim-log-section"></div>
</div>

<!-- â•â• UGE VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="view-uge" style="display:none">
  <div class="picker-row">
    <label>Uge:</label>
    <select id="week-select" onchange="renderUge()"></select>
  </div>
  <div class="section-title">Team KPI'er</div>
  <div class="kpi-row" id="team-kpis"></div>
  <div class="section-title">Individuelle Scoreboards</div>
  <div class="seller-grid" id="seller-cards"></div>
  <div class="section-title">Trend â€“ Alle uger</div>
  <div class="grid-2" style="margin-bottom:14px">
    <div class="card"><div class="card-title">MiM pr. sÃ¦lger</div><canvas id="mimChart" height="200"></canvas></div>
    <div class="card"><div class="card-title">KT + SS pr. sÃ¦lger</div><canvas id="ktChart" height="200"></canvas></div>
  </div>
  <div class="grid-2">
    <div class="card"><div class="card-title">Samtaler pr. sÃ¦lger</div><canvas id="samChart" height="200"></canvas></div>
    <div class="card"><div class="card-title">GF pr. sÃ¦lger (floor 1,90)</div><canvas id="gfChart" height="200"></canvas></div>
  </div>
  <div class="section-title" id="mim-details-title">MiM-detaljer</div>
  <div class="mim-grid" id="mim-details"></div>
</div>

<!-- â•â• MÃ…NED VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="view-maaned" style="display:none">
  <div class="picker-row">
    <label>MÃ¥ned:</label>
    <select id="month-select" onchange="renderMaaned()"></select>
  </div>
  <div class="section-title">Team KPI'er â€“ MÃ¥nedsoverblik</div>
  <div class="kpi-row" id="month-team-kpis"></div>
  <div class="section-title">Individuelle Scoreboards â€“ MÃ¥nedstotaler</div>
  <div class="seller-grid" id="month-seller-cards"></div>
  <div class="section-title">Ugentlig progression</div>
  <div class="grid-2">
    <div class="card"><div class="card-title">MiM pr. uge</div><canvas id="monthMimChart" height="200"></canvas></div>
    <div class="card"><div class="card-title">KT + SS pr. uge</div><canvas id="monthKtChart" height="200"></canvas></div>
  </div>
  <div class="section-title" id="month-mim-title">MiM-detaljer</div>
  <div class="mim-grid" id="month-mim-details"></div>
</div>

<!-- â•â• PERSON VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="view-person" style="display:none">
  <div class="picker-row">
    <label>SÃ¦lger:</label>
    <select id="person-select" onchange="renderPerson()">
      <option value="William">William</option>
      <option value="Jonas">Jonas</option>
      <option value="Andreas">Andreas</option>
    </select>
    <label style="margin-left:14px">Uge:</label>
    <select id="person-week-select" onchange="renderPerson()"></select>
  </div>
  <div id="person-hero"></div>
  <div class="section-title">Ugentlig performance</div>
  <div class="card" style="margin-bottom:16px"><table class="week-table" id="person-week-table"></table></div>
  <div class="section-title">Trend</div>
  <div class="grid-3" style="margin-bottom:16px">
    <div class="card"><div class="card-title">MiM</div><canvas id="personMimChart" height="200"></canvas></div>
    <div class="card"><div class="card-title">KT + SS</div><canvas id="personKtChart" height="200"></canvas></div>
    <div class="card"><div class="card-title">GF gennemsnit</div><canvas id="personGfChart" height="200"></canvas></div>
  </div>
  <div class="section-title" id="person-mim-title">MiM-detaljer</div>
  <div id="person-mim-details"></div>
</div>

<!-- Celebration overlay â€” animated WebP background, Samsung TV compatible -->
<div id="mim-celebration-overlay">
  <div id="celebration-bg"></div>
  <div class="celebration-content" id="celebration-content"></div>
</div>

<!-- Sound toggle -->
<button class="sound-toggle" id="sound-toggle" title="Toggle celebration sound" onclick="toggleSoundMuted()">ğŸ”Š</button>

<!-- Test celebration button -->
<button class="test-celebration-btn" title="Test celebration" onclick="testCelebration()">=</button>

<script>
// TV MODE â€“ always on (optimized for Samsung Smart TV)
const TV_MODE = true;
document.body.classList.add('tv-mode');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxTb_Qpuo-mTBTxXdKydQqDUGmJ_VBq7f0r_QHmvJ7B1cXmDiXHG_Kp1jFHHzcs0SSK/exec';
const NAMES = ['William','Jonas','Andreas'];
const COLORS = { William:'#63AEFA', Jonas:'#DC7243', Andreas:'#82FCE0', floor:'#A72444', maal:'#3B3B61' };

// Seller photo configuration â€“ GitHub-hosted + localStorage fallback
const PHOTO_BASE_URL = 'https://raw.githubusercontent.com/sebpirad/DashboardPM/main/photos/';
const GITHUB_PHOTOS = {
  William: PHOTO_BASE_URL + 'william.jpg',
  Jonas: PHOTO_BASE_URL + 'jonas.jpg',
  Andreas: PHOTO_BASE_URL + 'andreas.jpg'
};

// Screener photo configuration
const SCREENER_NAMES = ['Amalie', 'Ali', 'Josefine', 'Nicholai'];
const SCREENER_PHOTOS = {
  Amalie: PHOTO_BASE_URL + 'amalie.jpg',
  Ali: PHOTO_BASE_URL + 'ali.jpg',
  Josefine: PHOTO_BASE_URL + 'josefine.jpg',
  Nicholai: PHOTO_BASE_URL + 'nicholai.jpg'
};
const SCREENER_COLORS = { Amalie: '#c084fc', Ali: '#fb923c', Josefine: '#f9a8d4', Nicholai: '#60a5fa' };

// HR Dashboard Apps Script endpoint for screener lookup
const HR_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwNgVLagf3MT5_JeJSWySpkbIEBquFOOHyr0WplT66cf6l3eWgImS0BO7RUYV4TaCp2/exec';

// Look up screener via HR Dashboard API (async)
async function findScreenerAsync(kandidatNavn) {
  if (!kandidatNavn) return null;
  try {
    const url = HR_APPS_SCRIPT_URL + '?action=findScreener&kandidat=' + encodeURIComponent(kandidatNavn.trim());
    const resp = await fetch(url);
    if (!resp.ok) { console.warn('HR screener lookup failed:', resp.status); return null; }
    const data = await resp.json();
    return data.screener || null;
  } catch (e) {
    console.warn('HR screener lookup error:', e);
    return null;
  }
}
const _githubPhotoVerified = {};
function getSellerPhoto(name) {
  if (GITHUB_PHOTOS[name] && _githubPhotoVerified[name] !== false) return GITHUB_PHOTOS[name];
  try { return localStorage.getItem('pm_photo_'+name) || ''; } catch(e) { return ''; }
}
function setSellerPhoto(name, dataUrl) {
  try { localStorage.setItem('pm_photo_'+name, dataUrl); } catch(e) { console.warn('localStorage full'); }
}
function removeSellerPhoto(name) {
  try { localStorage.removeItem('pm_photo_'+name); } catch(e) {}
}
function verifyGitHubPhotos() {
  for (const name of NAMES) {
    if (GITHUB_PHOTOS[name]) {
      const img = new Image();
      img.onload = () => { _githubPhotoVerified[name] = true; };
      img.onerror = () => { _githubPhotoVerified[name] = false; };
      img.src = GITHUB_PHOTOS[name];
    }
  }
}
let _photoUploadTarget = null; // which seller we're uploading for

// Dynamic â€“ computed from data at load time
let WEEK_RANGES = {};   // wn â†’ [start, end]
let MONTH_RANGES = {};  // 'YYYY-MM' â†’ [start, end]
let WEEK_LABELS = {};   // wn â†’ 'U5 (26/1)'
let WEEKS_IN_MONTH = {}; // 'YYYY-MM' â†’ [wn, ...]
let ALL_WEEKS = [];     // sorted week numbers

let _rawData={}, _trendData={}, _budgets={}, _charts={}, _currentTab='daglig';

// MiM tracking
let _seenMiM = new Set();
let _mimLog = [];
let _sellerMimCount = { William: 0, Jonas: 0, Andreas: 0 };
let _sellerMimToday = { William: 0, Jonas: 0, Andreas: 0 };
let _sellerStreak = { William: 0, Jonas: 0, Andreas: 0 };
let _soundMuted = false;
let _autoRefreshInterval = null;
let _userHasInteracted = false;
let _audioCtx = null;

// Unlock audio on FIRST user interaction (Chrome autoplay policy)
document.addEventListener('click', function _unlockAudio() {
  _userHasInteracted = true;
  try {
    if (!_audioCtx) _audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (_audioCtx.state === 'suspended') _audioCtx.resume();
  } catch(e) {}
}, { once: false });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmtDate(d) {
  if (!(d instanceof Date)) return String(d||'');
  return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
}
function parseDate(str) {
  if (!str) return null;
  if (str instanceof Date) return str;
  const s = str.trim();
  const m = s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
  if (m) return new Date(+m[3],+m[2]-1,+m[1]);
  const iso = s.match(/^(\d{4})-(\d{2})-(\d{2})/);
  if (iso) return new Date(+iso[1],+iso[2]-1,+iso[3]);
  return null;
}
function inRange(ds,s,e){ const d=parseDate(ds); return d&&d>=s&&d<=e; }
function dk(s){ if(s===null||s===undefined||s==='') return NaN; if(typeof s==='number') return s; return parseFloat(String(s).trim().replace(',','.')); }
function fmt(v,dec=0){ return v===null?'â€”':typeof v==='number'?v.toFixed(dec):v; }

// â”€â”€ Thresholds: 0-65 red, 66-99 yellow, 100+ green â”€â”€
function idx(a,t){ return t>0?Math.round(a/t*100):0; }
function idxBadge(i){
  if(i>=126) return `<span class="badge badge-gold">${i} â­</span>`;
  if(i>=100) return `<span class="badge badge-green">${i} ğŸŸ¢</span>`;
  if(i>=66)  return `<span class="badge badge-yellow">${i} ğŸŸ¡</span>`;
  return `<span class="badge badge-red">${i} ğŸ”´</span>`;
}
function idxColor(i){ return i>=126?'gold':i>=100?'green':i>=66?'yellow':'red'; }
function barColorClass(i){ return i>=126?'c-gold':i>=100?'c-green':i>=66?'c-yellow':'c-red'; }
function ringColor(i){ return i>=126?'#82FCE0':i>=100?'#34D399':i>=66?'#fbbf24':'#ef4444'; }

function delta(a,b){ const d=a-b; return d>0?`<span class="delta-pos">+${d}</span>`:d<0?`<span class="delta-neg">${d}</span>`:`<span class="delta-neu">0</span>`; }
function deltaF(a,b){ if(a===null||b===null) return ''; const d=(a-b).toFixed(3); return parseFloat(d)>0?`<span class="delta-pos">+${d}</span>`:parseFloat(d)<0?`<span class="delta-neg">${d}</span>`:`<span class="delta-neu">0</span>`; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CORE CALC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcSellerArr(rows,ws,we){
  if(!rows||rows.length<2) return {KT:0,SS:0,Samtaler:0,MiM:0,mimRows:[],gnsGF:null,gnsKS:null,lowGF:0};
  let KT=0,SS=0,Samtaler=0,mimRows=[];
  for(let i=1;i<rows.length;i++){
    const r=rows[i];
    const g=v=>v instanceof Date?fmtDate(v):String(v||'');
    const r0=g(r[0]),r1=g(r[1]),r3=g(r[3]),r6=g(r[6]),r7=g(r[7]);
    const r13=g(r[13]),r14=g(r[14]),r15=g(r[15]),r16=g(r[16]),r17=g(r[17]),r18=g(r[18]),r21=g(r[21]);
    if(inRange(r0,ws,we)&&r1.trim()){ KT++; if(/\bJa\b/i.test(r3)) SS++; }
    if(inRange(r6,ws,we)&&r7.trim()) Samtaler++;
    if(inRange(r13,ws,we)&&r15.trim()){
      if(/startede aldrig/i.test(r21)||/opsagt samme uge/i.test(r21)) continue;
      mimRows.push({dato:r13,kandidat:r14,virk:r15,timelon:dk(r16),gf:dk(r17),ks:dk(r18),status:r21});
    }
  }
  const vGF=mimRows.filter(r=>!isNaN(r.gf)), vKS=mimRows.filter(r=>!isNaN(r.ks));
  return { KT,SS,Samtaler,MiM:mimRows.length,mimRows,
    gnsGF:vGF.length?vGF.reduce((s,r)=>s+r.gf,0)/vGF.length:null,
    gnsKS:vKS.length?vKS.reduce((s,r)=>s+r.ks,0)/vKS.length:null,
    lowGF:vGF.filter(r=>r.gf<1.90).length };
}

// ISO week number for a date
function isoWeek(d){
  const t=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate()));
  t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));
  const y=new Date(Date.UTC(t.getUTCFullYear(),0,1));
  return Math.ceil(((t-y)/86400000+1)/7);
}

// Get Monday of ISO week
function mondayOfWeek(wn, year){
  const jan4=new Date(year,0,4);
  const dow=jan4.getDay()||7;
  const mon=new Date(jan4);
  mon.setDate(jan4.getDate()-(dow-1)+(wn-1)*7);
  return mon;
}

// Build dynamic week ranges from all dates found in data + ALWAYS include today's week
function buildWeekRanges(){
  const sheets=['Data Input - William','Data Input - Jonas','Data Input - Andreas'];
  const weekSet=new Set();
  // Always include today
  const today=new Date(); today.setHours(0,0,0,0);
  weekSet.add(isoWeek(today)+'|'+today.getFullYear());
  for(const sheet of sheets){
    const rows=_rawData[sheet]||[];
    for(let i=1;i<rows.length;i++){
      const r=rows[i];
      const g=v=>v instanceof Date?fmtDate(v):String(v||'');
      [g(r[0]),g(r[6]),g(r[13])].forEach(ds=>{
        const d=parseDate(ds);
        if(d) weekSet.add(isoWeek(d)+'|'+d.getFullYear());
      });
    }
  }
  WEEK_RANGES={}; WEEK_LABELS={}; WEEKS_IN_MONTH={}; MONTH_RANGES={};
  const monthSet=new Set();
  for(const key of weekSet){
    const [wn,yr]= key.split('|').map(Number);
    const mon=mondayOfWeek(wn,yr);
    const sun=new Date(mon); sun.setDate(mon.getDate()+6);
    WEEK_RANGES[wn]=[mon,sun];
    WEEK_LABELS[wn]=`U${wn} (${mon.getDate()}/${mon.getMonth()+1})`;
    const mKey=`${yr}-${String(mon.getMonth()+1).padStart(2,'0')}`;
    monthSet.add(mKey);
    if(!WEEKS_IN_MONTH[mKey]) WEEKS_IN_MONTH[mKey]=[];
    if(!WEEKS_IN_MONTH[mKey].includes(wn)) WEEKS_IN_MONTH[mKey].push(wn);
    const mKey2=`${sun.getFullYear()}-${String(sun.getMonth()+1).padStart(2,'0')}`;
    if(mKey2!==mKey){ monthSet.add(mKey2); if(!WEEKS_IN_MONTH[mKey2]) WEEKS_IN_MONTH[mKey2]=[]; if(!WEEKS_IN_MONTH[mKey2].includes(wn)) WEEKS_IN_MONTH[mKey2].push(wn); }
  }
  // Always include today's month
  const todayMk=`${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}`;
  if(!monthSet.has(todayMk)) monthSet.add(todayMk);
  for(const mk of Object.keys(WEEKS_IN_MONTH)) WEEKS_IN_MONTH[mk].sort((a,b)=>a-b);
  for(const mk of monthSet){
    const [yr,mo]=mk.split('-').map(Number);
    MONTH_RANGES[mk]=[new Date(yr,mo-1,1), new Date(yr,mo,0)];
  }
  ALL_WEEKS=Object.keys(WEEK_RANGES).map(Number).sort((a,b)=>a-b);
}

// Find which week a date belongs to
function weekForDate(d){
  for(const [wn,[ws,we]] of Object.entries(WEEK_RANGES)){
    if(d>=ws&&d<=we) return parseInt(wn);
  }
  return null;
}

// Get all unique dates in the dataset + always include today (if weekday)
function getAllDates(){
  const dates = new Set();
  // Always include today if it's a weekday
  const today=new Date(); today.setHours(0,0,0,0);
  if(today.getDay()!==0 && today.getDay()!==6) dates.add(fmtDate(today));
  const sheets = ['Data Input - William','Data Input - Jonas','Data Input - Andreas'];
  for(const sheet of sheets){
    const rows = _rawData[sheet]||[];
    for(let i=1;i<rows.length;i++){
      const r=rows[i];
      const g=v=>v instanceof Date?fmtDate(v):String(v||'');
      [g(r[0]),g(r[6]),g(r[13])].forEach(ds=>{
        const d=parseDate(ds);
        if(d && d.getDay()!==0 && d.getDay()!==6) dates.add(fmtDate(d));
      });
    }
  }
  const sorted=[...dates].sort((a,b)=>parseDate(b)-parseDate(a));
  return sorted;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MIM CELEBRATION SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Generate avatar from initials or stored photo
function generateSellerAvatar(name, size=180) {
  const photo = getSellerPhoto(name);
  if (photo) {
    return `<img src="${photo}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;" alt="${name}">`;
  }
  const initial = name[0];
  const color = COLORS[name];
  const fs = size > 120 ? 80 : size > 60 ? 36 : 24;
  return `<div style="background:${color}22; color:${color}; width:100%; height:100%; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:${fs}px; font-weight:900;">${initial}</div>`;
}

// Photo Manager
function togglePhotoMgr() {
  const el = document.getElementById('photo-mgr');
  el.classList.toggle('open');
  if (el.classList.contains('open')) renderPhotoMgr();
}
function renderPhotoMgr() {
  document.getElementById('photo-mgr-grid').innerHTML = NAMES.map(name => {
    const photo = getSellerPhoto(name);
    const inner = photo
      ? `<img src="${photo}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`
      : `<div style="background:${COLORS[name]}22;color:${COLORS[name]};width:100%;height:100%;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:900">${name[0]}</div>`;
    const action = photo
      ? `<div class="photo-mgr-action" onclick="event.stopPropagation();removeSellerPhoto('${name}');renderPhotoMgr()">Fjern foto</div>`
      : `<div class="photo-mgr-action" onclick="startPhotoUpload('${name}')">Upload foto</div>`;
    return `<div class="photo-mgr-item">
      <div class="photo-mgr-avatar" onclick="startPhotoUpload('${name}')">${inner}</div>
      <div class="photo-mgr-name" style="color:${COLORS[name]}">${name}</div>
      ${action}
    </div>`;
  }).join('');
}
function startPhotoUpload(name) {
  _photoUploadTarget = name;
  document.getElementById('photo-upload-input').click();
}
function handlePhotoUpload(e) {
  const file = e.target.files[0];
  if (!file || !_photoUploadTarget) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    // Resize to max 300x300 to keep localStorage manageable
    const img = new Image();
    img.onload = function() {
      const canvas = document.createElement('canvas');
      const max = 300;
      let w = img.width, h = img.height;
      if (w > h) { h = Math.round(h * max / w); w = max; }
      else { w = Math.round(w * max / h); h = max; }
      canvas.width = w; canvas.height = h;
      canvas.getContext('2d').drawImage(img, 0, 0, w, h);
      const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
      setSellerPhoto(_photoUploadTarget, dataUrl);
      renderPhotoMgr();
      _photoUploadTarget = null;
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
  e.target.value = ''; // reset for re-upload
}

// Dynamic comment selection
function getComments(seller, candidate, company, gf, dayMimCount, weekMimCount, dayOfWeek, hour) {
  const comments = [];

  // First MiM of the day
  if (dayMimCount === 1) {
    comments.push(`${seller} Ã¥bner ballet!`);
  }

  // 2nd MiM same day
  if (dayMimCount === 2) {
    comments.push(`${seller} er VARM i dag!`);
  }

  // 3rd+ MiM same day
  if (dayMimCount >= 3) {
    comments.push(`HAT-TRICK! ${seller} er USTOPPELIG!`);
  }

  // GF checks
  if (!isNaN(gf)) {
    if (gf >= 2.20) {
      comments.push(`Premium placement â€“ GF pÃ¥ ${gf.toFixed(2)}!`);
    } else if (gf < 1.90) {
      comments.push(`Obs: GF under floor (${gf.toFixed(2)})`);
    }
  }

  // Time-based
  if (hour < 10) {
    comments.push(`Tidlig fugl fanger ormen!`);
  } else if (hour >= 15) {
    comments.push(`Endnu Ã©n inden lukketid!`);
  }

  // Weekly leader (would need comparison logic)

  return comments.length > 0 ? comments : ['MiM confirmed!'];
}

// Get combo level (expanded to 6 levels)
function getComboLevel(dayMimCount) {
  if (dayMimCount >= 6) return 6;
  if (dayMimCount === 5) return 5;
  if (dayMimCount === 4) return 4;
  if (dayMimCount === 3) return 3;
  if (dayMimCount === 2) return 2;
  return 1;
}


// â•â•â• AC/DC â€“ THUNDERSTRUCK (iTunes 30s Preview) â•â•â•
const THUNDERSTRUCK_URL = 'https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview125/v4/f3/45/64/f3456422-afe5-5218-0144-6a2dd6754a2b/mzaf_8906497323614731144.plus.aac.p.m4a';
let _thunderAudio = null;

// Pre-load audio on page load for instant playback
(function preloadThunderstruck() {
  try {
    _thunderAudio = new Audio(THUNDERSTRUCK_URL);
    _thunderAudio.preload = 'auto';
    _thunderAudio.volume = 0.85;
    _thunderAudio.load();
  } catch(e) { console.log('Audio preload failed:', e); }
})();

function playCelebrationSound(comboLevel = 1) {
  if (_soundMuted) return;
  stopCelebrationSound();
  try {
    // Resume AudioContext if needed (unlocks audio on Chrome)
    if (_audioCtx && _audioCtx.state === 'suspended') _audioCtx.resume();

    // Re-create audio element for clean playback every time
    _thunderAudio = new Audio(THUNDERSTRUCK_URL);
    _thunderAudio.volume = Math.min(0.7 + comboLevel * 0.05, 1.0);
    _thunderAudio.loop = false;  // 30s preview matches 30s celebration
    _thunderAudio.currentTime = 0;
    _thunderAudio.play().catch(e => console.log('Audio play blocked:', e));
  } catch(e) {
    console.log('Thunderstruck failed:', e);
  }
}

function stopCelebrationSound() {
  try {
    if (_thunderAudio) {
      _thunderAudio.pause();
      _thunderAudio.currentTime = 0;
      _thunderAudio.src = '';  // Force release audio resource
      _thunderAudio.load();    // Reset the element
      _thunderAudio = null;
    }
  } catch(e) {}
}

// Track all celebration timers so we can clean up
let _celebrationTimers = [];
let _celebrationIntervals = [];
let _celebrationQueue = [];
let _celebrationRunning = false;

// Process celebration queue â€“ one at a time, 15s pause between
function processCelebrationQueue() {
  if (_celebrationRunning || _celebrationQueue.length === 0) return;
  _celebrationRunning = true;
  const { seller, mimData, dayCount, weekMiMs } = _celebrationQueue.shift();
  showCelebration(seller, mimData, dayCount, weekMiMs);
  // After 32s celebration (2s warmup + 30s visible) ends, wait 15s, then play next
  setTimeout(() => {
    _celebrationRunning = false;
    if (_celebrationQueue.length > 0) {
      setTimeout(() => processCelebrationQueue(), 15000);
    }
  }, 35000);
}

function clearCelebration() {
  _celebrationTimers.forEach(t => clearTimeout(t));
  _celebrationIntervals.forEach(t => clearInterval(t));
  _celebrationTimers = [];
  _celebrationIntervals = [];
  stopCelebrationSound();
  // Stop video and destroy bg element
  const oldVid = document.getElementById('celebration-video');
  if (oldVid) { oldVid.pause(); oldVid.removeAttribute('src'); oldVid.load(); }
  const oldBg = document.getElementById('celebration-bg');
  if (oldBg) { oldBg.parentNode.removeChild(oldBg); }
  const overlay = document.getElementById('mim-celebration-overlay');
  overlay.classList.remove('active');
  overlay.removeAttribute('style');
  // Re-create pre-buffered video for next celebration (instant playback)
  if (!document.getElementById('celebration-video-preloaded')) {
    const pv = document.createElement('video');
    pv.id = 'celebration-video-preloaded';
    pv.muted = true;
    pv.playsInline = true;
    pv.preload = 'auto';
    pv.src = 'celebration_final.mp4';
    pv.style.cssText = 'position:fixed;top:-9999px;left:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;';
    document.body.appendChild(pv);
    pv.load();
    pv.addEventListener('canplaythrough', function() {
      pv.play().then(function() {
        setTimeout(function() { pv.pause(); pv.currentTime = 0; }, 100);
      }).catch(function() {});
    }, { once: true });
  }
}

// WILD & EXPLOSIVE Main celebration
function showCelebration(seller, mimData, dayMimCount, weekMimCount) {
  // Kill any running celebration first
  clearCelebration();
  // Launch immediately â€” video starts inside _launchCelebration
  _launchCelebration(seller, mimData, dayMimCount, weekMimCount);
}

function _launchCelebration(seller, mimData, dayMimCount, weekMimCount) {
  const overlay = document.getElementById('mim-celebration-overlay');
  if (overlay.classList.contains('active')) return;

  const content = document.getElementById('celebration-content');
  const comboLevel = getComboLevel(dayMimCount);

  const cTimeout = (fn, ms) => { const t = setTimeout(fn, ms); _celebrationTimers.push(t); return t; };

  // Reuse pre-buffered video (already decoded in hardware) or create fallback
  const existingBg = document.getElementById('celebration-bg');
  if (existingBg) existingBg.parentNode.removeChild(existingBg);
  const bg = document.createElement('div');
  bg.id = 'celebration-bg';

  let vid = document.getElementById('celebration-video-preloaded');
  if (vid) {
    // Move pre-buffered video into celebration bg â€” instant playback
    vid.id = 'celebration-video';
    vid.style.cssText = '';  // Remove hidden positioning
    bg.appendChild(vid);
  } else {
    // Fallback: create new video element
    vid = document.createElement('video');
    vid.id = 'celebration-video';
    vid.muted = true;
    vid.playsInline = true;
    vid.preload = 'auto';
    vid.src = 'celebration_final.mp4';
    bg.appendChild(vid);
  }
  // Start video HIDDEN 2s before showing overlay â€” lets hardware decoder warm up
  overlay.insertBefore(bg, overlay.firstChild);
  bg.style.opacity = '0';
  vid.currentTime = 0;
  vid.play().catch(function() {});

  const sellerPhoto = GITHUB_PHOTOS[seller] || '';

  // Combo text
  let comboText = '';
  if (comboLevel === 2) comboText = 'COMBO x2';
  else if (comboLevel === 3) comboText = 'COMBO x3';
  else if (comboLevel === 4) comboText = 'COMBO x4';
  else if (comboLevel === 5) comboText = 'COMBO x5';
  else if (comboLevel >= 6) comboText = 'COMBO x' + dayMimCount;

  // Build seller avatar HTML
  const sellerAvatarHtml = sellerPhoto
    ? `<img src="${sellerPhoto}" alt="${seller}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
       <div class="cel-avatar-fallback" style="display:none">${seller.charAt(0)}</div>`
    : `<div class="cel-avatar-fallback">${seller.charAt(0)}</div>`;

  // === BUILD HTML â€” starts WITHOUT screener, added async when HR API responds ===
  let html = `
    <div class="cel-title-section">
      <div class="cel-title">Mand i Marken!</div>
      <div class="cel-combo" id="cel-combo"></div>
    </div>

    <div class="cel-people-row" id="cel-people-row">
      <div class="cel-person" id="cel-person-closer">
        <div class="cel-avatar-ring closer">${sellerAvatarHtml}</div>
        <div class="cel-person-name">${seller}</div>
      </div>
    </div>

    <div class="cel-deal-card" id="cel-deal-card">
      <div class="cel-deal-kandidat">${mimData.kandidat || 'â€”'}</div>
      <div class="cel-deal-virksomhed">${mimData.virk || 'â€”'}</div>
      <div class="cel-deal-stats">
        <div class="cel-stat">
          <span class="cel-stat-value">${isNaN(mimData.gf) ? 'â€”' : mimData.gf.toFixed(2)}</span>
          <span class="cel-stat-label">Garantifaktor</span>
        </div>
        <div class="cel-stat-divider"></div>
        <div class="cel-stat">
          <span class="cel-stat-value">${isNaN(mimData.timelon) ? 'â€”' : mimData.timelon.toFixed(0)} kr</span>
          <span class="cel-stat-label">Timel\u00f8n</span>
        </div>
        <div class="cel-stat-divider"></div>
        <div class="cel-stat">
          <span class="cel-stat-value">${isNaN(mimData.ks) ? 'â€”' : mimData.ks.toFixed(0)} kr</span>
          <span class="cel-stat-label">Kostpris</span>
        </div>
      </div>
    </div>`;

  content.innerHTML = html;

  // === ASYNC: Fetch screener from HR Dashboard and inject when ready ===
  const screenerPromise = _testScreenerOverride
    ? Promise.resolve(_testScreenerOverride)
    : findScreenerAsync(mimData.kandidat);

  screenerPromise.then(function(screener) {
    if (!screener) return;
    const screenerPhoto = SCREENER_PHOTOS[screener] || '';
    const screenerAvatarHtml = screenerPhoto
      ? `<img src="${screenerPhoto}" alt="${screener}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
         <div class="cel-avatar-fallback" style="display:none">${screener.charAt(0)}</div>`
      : `<div class="cel-avatar-fallback">${screener.charAt(0)}</div>`;

    const peopleRow = document.getElementById('cel-people-row');
    if (!peopleRow) return;

    const screenerDiv = document.createElement('div');
    screenerDiv.className = 'cel-person';
    screenerDiv.id = 'cel-person-screener';
    screenerDiv.innerHTML = `
      <div class="cel-avatar-ring screener">${screenerAvatarHtml}</div>
      <div class="cel-person-name">${screener}</div>`;
    peopleRow.appendChild(screenerDiv);

    // Trigger animation after DOM insert
    requestAnimationFrame(function() {
      screenerDiv.classList.add('animate-in');
    });
  });

  // === TIMELINE â€” 2s warmup buffer, then reveal ===
  // T=0: Video starts playing hidden (hardware decoder warming up)
  // T=2s: Overlay fades in with video already smooth
  const WARMUP = 2000;

  cTimeout(() => {
    bg.style.transition = 'opacity 0.5s ease';
    bg.style.opacity = '1';
    overlay.removeAttribute('style');
    overlay.classList.remove('active');
    void overlay.offsetHeight;
    overlay.classList.add('active');
  }, WARMUP);

  // T=2.5s: Music
  cTimeout(() => playCelebrationSound(comboLevel), WARMUP + 500);

  // T=2.8s: Closer avatar reveals
  cTimeout(() => {
    const el = document.getElementById('cel-person-closer');
    if (el) el.classList.add('animate-in');
  }, WARMUP + 800);

  // T=3.5s: Deal card slides up
  cTimeout(() => {
    const el = document.getElementById('cel-deal-card');
    if (el) el.classList.add('show');
  }, WARMUP + 1500);

  // T=4.0s: Combo badge pops in
  if (comboText) {
    cTimeout(() => {
      const el = document.getElementById('cel-combo');
      if (el) { el.textContent = comboText; el.classList.add('show'); }
    }, WARMUP + 2000);
  }

  // T=32s: Auto-close (2s warmup + 30s visible = matches Thunderstruck length)
  cTimeout(() => clearCelebration(), WARMUP + 30000);
}

// Check for new MiM â€“ only "Dato" (col 13) = today triggers celebration
function checkForNewMiM() {
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const sheets = ['Data Input - William', 'Data Input - Jonas', 'Data Input - Andreas'];

  const newMiMs = [];

  for (let i = 0; i < NAMES.length; i++) {
    const seller = NAMES[i];
    const rows = _rawData[sheets[i]] || [];
    const data = calcSellerArr(rows, today, today);

    _sellerMimToday[seller] = data.MiM;

    for (const mimRow of data.mimRows) {
      const key = `${seller}|${mimRow.kandidat}|${mimRow.virk}|${mimRow.dato}`;

      // Check ALL key fields are present BEFORE marking as seen
      const hasKandidat = mimRow.kandidat && mimRow.kandidat.trim();
      const hasVirk = mimRow.virk && mimRow.virk.trim();
      const hasGF = !isNaN(mimRow.gf);
      const hasTimelon = !isNaN(mimRow.timelon);
      const hasKostpris = !isNaN(mimRow.ks);
      const isComplete = hasKandidat && hasVirk && hasGF && hasTimelon && hasKostpris;

      // Incomplete rows are SKIPPED â€” not marked seen â€” so next refresh rechecks them
      if (!isComplete) continue;

      if (!_seenMiM.has(key)) {
        _seenMiM.add(key);
        newMiMs.push({ seller, mimData: mimRow, dayCount: _sellerMimToday[seller] });

        _mimLog.push({
          time: new Date(),
          seller,
          candidate: mimRow.kandidat,
          company: mimRow.virk,
          gf: mimRow.gf,
          combo: getComboLevel(_sellerMimToday[seller])
        });
      }
    }
  }

  return newMiMs;
}

// Mark all current MiM as seen (on first load)
function initializeMiMTracking() {
  _seenMiM.clear();
  _mimLog = [];
  const sheets = ['Data Input - William', 'Data Input - Jonas', 'Data Input - Andreas'];

  for (let i = 0; i < NAMES.length; i++) {
    const seller = NAMES[i];
    const rows = _rawData[sheets[i]] || [];
    for (let j = 1; j < rows.length; j++) {
      const r = rows[j];
      const g = v => v instanceof Date ? fmtDate(v) : String(v || '');
      const r13 = g(r[13]), r14 = g(r[14]), r15 = g(r[15]), r21 = g(r[21]);

      if (r15.trim() && r13.trim()) {
        if (!/startede aldrig/i.test(r21) && !/opsagt samme uge/i.test(r21)) {
          const key = `${seller}|${r14}|${r15}|${r13}`;
          _seenMiM.add(key);
        }
      }
    }
  }
}

function toggleSoundMuted() {
  _soundMuted = !_soundMuted;
  const btn = document.getElementById('sound-toggle');
  btn.textContent = _soundMuted ? 'ğŸ”‡' : 'ğŸ”Š';
  btn.classList.toggle('muted', _soundMuted);
}

// Cycle through combo levels on each test click
let _testComboLevel = 0;
let _testScreenerOverride = null;
function testCelebration() {
  _testComboLevel = (_testComboLevel % 6) + 1;
  _testScreenerOverride = 'Amalie';
  showCelebration('William', {
    kandidat: 'Test Kandidat',
    virk: 'Test Virksomhed',
    gf: 2.15,
    timelon: 285,
    ks: 195
  }, _testComboLevel, 5);
  // Clear override after launch so real celebrations use lookup
  setTimeout(() => { _testScreenerOverride = null; }, 2000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FETCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAll(){
  document.getElementById('loading').style.display='flex';
  ['daglig','uge','maaned','person'].forEach(t=>document.getElementById('view-'+t).style.display='none');
  document.getElementById('error-msg').style.display='none';
  try{
    const r=await fetch(APPS_SCRIPT_URL+'?cb='+Date.now());
    if(!r.ok) throw new Error('HTTP '+r.status);
    const json=await r.json();
    ['Data Input - William','Data Input - Jonas','Data Input - Andreas','Budgetter'].forEach(n=>_rawData[n]=json[n]||[]);

    // Screener lookup now handled via HR Dashboard API (findScreenerAsync)

    // 1) Build dynamic week ranges from data
    buildWeekRanges();

    // 2) Compute trend for every discovered week
    const sheets=['Data Input - William','Data Input - Jonas','Data Input - Andreas'];
    for(const wn of ALL_WEEKS){
      const [ws,we]=WEEK_RANGES[wn];
      _trendData[wn]={};
      for(let i=0;i<NAMES.length;i++) _trendData[wn][NAMES[i]]=calcSellerArr(_rawData[sheets[i]],ws,we);
    }

    // 3) Parse ALL budget rows (not limited to specific weeks)
    _budgets={};
    const budRows=_rawData['Budgetter']||[];
    for(const r of budRows){
      const wn=parseInt(r[0]);
      if(!isNaN(wn)){
        _budgets[wn]={ indiv:{KT:parseInt(r[1])||0,SS:parseInt(r[2])||0,Sam:parseInt(r[3])||0,MiM:parseInt(r[4])||0} };
        _budgets[wn].team=Object.fromEntries(Object.entries(_budgets[wn].indiv).map(([k,v])=>[k,v*3]));
      }
    }

    // 4) MiM tracking: on first load mark all as seen, on subsequent loads detect & celebrate
    if (_firstLoad) {
      initializeMiMTracking(); // marks all existing MiM as "seen" â€“ no false celebrations
      _firstLoad = false;
    } else {
      // Skip MiM detection while celebration is active (prevents double-trigger)
      if (!_celebrationRunning) {
        const newMiMs = checkForNewMiM();
        // Add to celebration queue â€“ played sequentially with 15s pause between
        for (const { seller, mimData, dayCount } of newMiMs) {
          const weekMiMs = _trendData[isoWeek(new Date())]?.[seller]?.MiM || 0;
          _celebrationQueue.push({ seller, mimData, dayCount, weekMiMs });
        }
        processCelebrationQueue();
      }
    }

    // 5) Populate day-select â€“ default to today
    const today=new Date(); today.setHours(0,0,0,0);
    const todayStr=fmtDate(today);
    const allDates=getAllDates();
    const daySelEl=document.getElementById('day-select');
    const dNames=['SÃ¸n','Man','Tir','Ons','Tor','Fre','LÃ¸r'];
    daySelEl.innerHTML=allDates.map(ds=>{
      const d=parseDate(ds);
      const isSel=ds===todayStr;
      return `<option value="${ds}"${isSel?' selected':''}>${dNames[d.getDay()]} ${ds}</option>`;
    }).join('');

    // 6) Populate week-select â€“ default to current week
    const curWeek=isoWeek(today);
    const weeksDesc=[...ALL_WEEKS].reverse();
    const fmtW=wn=>{
      const [ws,we]=WEEK_RANGES[wn];
      return `Uge ${wn} (${String(ws.getDate()).padStart(2,'0')}/${String(ws.getMonth()+1).padStart(2,'0')}â€“${String(we.getDate()).padStart(2,'0')}/${String(we.getMonth()+1).padStart(2,'0')})`;
    };
    document.getElementById('week-select').innerHTML=weeksDesc.map(wn=>`<option value="${wn}"${wn===curWeek?' selected':''}>${fmtW(wn)}</option>`).join('');
    document.getElementById('person-week-select').innerHTML=weeksDesc.map(wn=>`<option value="${wn}"${wn===curWeek?' selected':''}>Uge ${wn}</option>`).join('');

    // 7) Populate month-select â€“ default to current month
    const curMonth=`${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}`;
    const months=Object.keys(MONTH_RANGES).sort().reverse();
    const mNames=['','Januar','Februar','Marts','April','Maj','Juni','Juli','August','September','Oktober','November','December'];
    document.getElementById('month-select').innerHTML=months.map(mk=>{
      const [yr,mo]=mk.split('-').map(Number);
      return `<option value="${mk}"${mk===curMonth?' selected':''}>${mNames[mo]} ${yr}</option>`;
    }).join('');

    document.getElementById('last-updated').textContent='Opdateret: '+new Date().toLocaleTimeString('da-DK');
    document.getElementById('loading').style.display='none';
    switchTab(_currentTab);

    // Dismiss splash preloader after first successful load
    const splash = document.getElementById('splash-preloader');
    if (splash) {
      splash.classList.add('fade-out');
      setTimeout(() => splash.remove(), 600);
    }

    // Pre-buffer celebration video: hidden, fully decoded, ready for instant playback
    if (!document.getElementById('celebration-video-preloaded')) {
      const pv = document.createElement('video');
      pv.id = 'celebration-video-preloaded';
      pv.muted = true;
      pv.playsInline = true;
      pv.preload = 'auto';
      pv.src = 'celebration_final.mp4';
      pv.style.cssText = 'position:fixed;top:-9999px;left:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;';
      document.body.appendChild(pv);
      pv.load();
      // Force hardware decoder warmup: play briefly then pause at frame 0
      pv.addEventListener('canplaythrough', function() {
        pv.play().then(function() {
          setTimeout(function() { pv.pause(); pv.currentTime = 0; }, 100);
        }).catch(function() {});
      }, { once: true });
    }

  }catch(e){
    document.getElementById('loading').style.display='none';
    // Also dismiss splash on error so user sees the error message
    const splash = document.getElementById('splash-preloader');
    if (splash) {
      splash.classList.add('fade-out');
      setTimeout(() => splash.remove(), 600);
    }
    document.getElementById('error-msg').style.display='block';
    document.getElementById('error-msg').textContent='âš ï¸ Fejl: '+e.message;
    console.error(e);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SILENT BACKGROUND REFRESH (no UI flicker)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function silentRefresh() {
  try {
    const r = await fetch(APPS_SCRIPT_URL + '?cb=' + Date.now());
    if (!r.ok) return;
    const json = await r.json();
    ['Data Input - William','Data Input - Jonas','Data Input - Andreas','Budgetter'].forEach(n => _rawData[n] = json[n] || []);

    buildWeekRanges();

    const sheets = ['Data Input - William','Data Input - Jonas','Data Input - Andreas'];
    for (const wn of ALL_WEEKS) {
      const [ws, we] = WEEK_RANGES[wn];
      _trendData[wn] = {};
      for (let i = 0; i < NAMES.length; i++) _trendData[wn][NAMES[i]] = calcSellerArr(_rawData[sheets[i]], ws, we);
    }

    _budgets = {};
    const budRows = _rawData['Budgetter'] || [];
    for (const br of budRows) {
      const wn = parseInt(br[0]);
      if (!isNaN(wn)) {
        _budgets[wn] = { indiv: { KT: parseInt(br[1]) || 0, SS: parseInt(br[2]) || 0, Sam: parseInt(br[3]) || 0, MiM: parseInt(br[4]) || 0 } };
        _budgets[wn].team = Object.fromEntries(Object.entries(_budgets[wn].indiv).map(([k, v]) => [k, v * 3]));
      }
    }

    // MiM detection
    if (!_celebrationRunning) {
      const newMiMs = checkForNewMiM();
      for (const { seller, mimData, dayCount } of newMiMs) {
        const weekMiMs = _trendData[isoWeek(new Date())]?.[seller]?.MiM || 0;
        _celebrationQueue.push({ seller, mimData, dayCount, weekMiMs });
      }
      processCelebrationQueue();
    }

    // Silent UI update â€” just re-render current tab + timestamp, no loading spinner
    document.getElementById('last-updated').textContent = 'Opdateret: ' + new Date().toLocaleTimeString('da-DK');
    switchTab(_currentTab);

  } catch (e) {
    console.warn('Silent refresh failed:', e);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAB SWITCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(tab){
  _currentTab=tab;
  ['daglig','uge','maaned','person'].forEach(t=>{
    document.getElementById('tab-'+t).classList.toggle('active',t===tab);
    document.getElementById('view-'+t).style.display=t===tab?'block':'none';
  });
  if(tab==='daglig') renderDaglig();
  if(tab==='uge') renderUge();
  if(tab==='maaned') renderMaaned();
  if(tab==='person') renderPerson();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHART HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function mkChart(id,cfg){ if(_charts[id]) _charts[id].destroy(); _charts[id]=new Chart(document.getElementById(id),cfg); }
const COP={plugins:{legend:{labels:{color:'#A499E2',font:{size:10}}}},scales:{x:{ticks:{color:'#757FBF'},grid:{color:'#272745'}},y:{ticks:{color:'#757FBF'},grid:{color:'#272745'}}}};

// SVG progress ring helper â€” HUD-style with tick marks and outer decoration
function ringSVG(pct, color, size=200, stroke=12){
  const cx=size/2, cy=size/2;
  const r=(size-stroke)/2, circ=2*Math.PI*r;
  const offset=circ*(1-Math.min(pct/100,1));
  // Outer decorative ring (thin, semi-transparent)
  const rOuter=r+stroke/2+4;
  // Tick marks around outer edge
  let ticks='';
  const tickR=rOuter+2;
  const tickLen=4;
  for(let i=0;i<60;i++){
    const angle=(i*6-90)*Math.PI/180;
    const x1=cx+tickR*Math.cos(angle);
    const y1=cy+tickR*Math.sin(angle);
    const x2=cx+(tickR+tickLen)*Math.cos(angle);
    const y2=cy+(tickR+tickLen)*Math.sin(angle);
    const isMajor=i%5===0;
    ticks+=`<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${isMajor?'rgba(130,252,224,0.3)':'rgba(130,252,224,0.1)'}" stroke-width="${isMajor?1.5:0.5}"/>`;
  }
  // Glow = extra circles with wider stroke + low opacity (NO filters â€” Mali-G31 renders all filters in rectangular buffer)
  return `<svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
    ${ticks}
    <circle cx="${cx}" cy="${cy}" r="${rOuter}" fill="none" stroke="rgba(130,252,224,0.08)" stroke-width="1" stroke-dasharray="3 3"/>
    <circle class="ring-bg" cx="${cx}" cy="${cy}" r="${r}" stroke-width="${stroke}"/>
    <circle fill="none" cx="${cx}" cy="${cy}" r="${r}" stroke="${color}" opacity="0.15"
      stroke-dasharray="${circ}" stroke-dashoffset="${offset}" stroke-width="${stroke+16}" stroke-linecap="round"/>
    <circle fill="none" cx="${cx}" cy="${cy}" r="${r}" stroke="${color}" opacity="0.08"
      stroke-dasharray="${circ}" stroke-dashoffset="${offset}" stroke-width="${stroke+30}" stroke-linecap="round"/>
    <circle class="ring-fg" cx="${cx}" cy="${cy}" r="${r}" stroke="${color}"
      stroke-dasharray="${circ}" stroke-dashoffset="${offset}" stroke-width="${stroke}"/>
  </svg>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DAGLIG RENDERER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDaglig(){
  const ds=document.getElementById('day-select').value;
  if(!ds) return;
  const d=parseDate(ds);
  const wn=weekForDate(d);
  const bud=_budgets[wn]?.indiv||{KT:15,SS:3,Sam:13,MiM:7};
  const dBud={KT:Math.ceil(bud.KT/5),SS:Math.ceil(bud.SS/5),Sam:Math.ceil(bud.Sam/5),MiM:Math.ceil(bud.MiM/5)};

  const dayNames=['SÃ¸ndag','Mandag','Tirsdag','Onsdag','Torsdag','Fredag','LÃ¸rdag'];
  document.getElementById('period-label').textContent=`${dayNames[d.getDay()]} ${ds} Â· Dagligt mÃ¥l Â· Live`;

  const sheets=['Data Input - William','Data Input - Jonas','Data Input - Andreas'];
  const dayData={};
  for(let i=0;i<NAMES.length;i++) dayData[NAMES[i]]=calcSellerArr(_rawData[sheets[i]],d,d);

  // Hall of Fame / MiM Log
  const logHTML = renderMimLog(d);
  document.getElementById('mim-log-section').innerHTML = logHTML;

  // â”€â”€ Individual cards: big ring + 4 bars (KT, SS, Samtaler, MiM) with % â”€â”€
  document.getElementById('daily-cards').innerHTML=NAMES.map(name=>{
    const s=dayData[name];
    const pctKT=idx(s.KT,dBud.KT), pctSS=idx(s.SS,dBud.SS), pctSam=idx(s.Samtaler,dBud.Sam), pctMiM=idx(s.MiM,dBud.MiM);
    const avgPct=Math.round((pctKT+pctSS+pctSam+pctMiM)/4);
    const color=COLORS[name];
    const isGold=avgPct>=126;

    function bar(label,actual,target,pct){
      const cc=barColorClass(pct);
      const rc=ringColor(pct);
      return `<div class="bar-row">
        <div class="bar-header">
          <span class="bar-label">${label}</span>
          <span class="bar-val">${actual} / ${target} <span class="bar-pct" style="color:${rc}">${pct}%</span></span>
        </div>
        <div class="bar-track"><div class="bar-fill ${cc}" style="width:${Math.min(pct,100)}%"></div></div>
      </div>`;
    }

    return `<div class="${isGold?'daily-card state-gold':'daily-card'}">
      <div class="daily-name" style="color:${color}">${name}</div>
      <div class="ring-wrap">
        ${ringSVG(avgPct, ringColor(avgPct), 180, 12)}
        <div class="ring-center">
          <div class="ring-pct" style="color:${ringColor(avgPct)}">${avgPct}%</div>
          <div class="ring-label">Samlet index</div>
        </div>
      </div>
      <div class="daily-bars">
        ${bar('KT', s.KT, dBud.KT, pctKT)}
        ${bar('SS', s.SS, dBud.SS, pctSS)}
        ${bar('Samtaler', s.Samtaler, dBud.Sam, pctSam)}
        ${bar('MiM', s.MiM, dBud.MiM, pctMiM)}
        ${s.gnsGF!==null?`<div style="margin-top:8px;font-size:11px;color:#94a3b8">GF: ${s.gnsGF.toFixed(3)}${s.gnsGF<1.90?' <span class="tag-low">â†“ lav</span>':' <span style="color:var(--green)">âœ“</span>'}</div>`:''}
      </div>
    </div>`;
  }).join('');

  // â”€â”€ Team donuts: KT, Samtaler, MiM â”€â”€
  const tKT=NAMES.reduce((s,n)=>s+dayData[n].KT,0), tSS=NAMES.reduce((s,n)=>s+dayData[n].SS,0);
  const tSam=NAMES.reduce((s,n)=>s+dayData[n].Samtaler,0), tMiM=NAMES.reduce((s,n)=>s+dayData[n].MiM,0);
  const tBud={KT:dBud.KT*3,SS:dBud.SS*3,Sam:dBud.Sam*3,MiM:dBud.MiM*3};
  const teamMetrics=[
    {l:'KT',v:tKT,m:tBud.KT},
    {l:'Samtaler',v:tSam,m:tBud.Sam},
    {l:'MiM',v:tMiM,m:tBud.MiM}
  ];
  document.getElementById('daily-team-donuts').innerHTML=teamMetrics.map(k=>{
    const i=idx(k.v,k.m);
    return `<div class="daily-team-card">
      <div class="daily-team-card-title">${k.l}</div>
      <div class="ring-sm">
        ${ringSVG(i, ringColor(i), 140, 10)}
        <div class="ring-center">
          <div class="ring-pct" style="color:${ringColor(i)}">${k.v}</div>
          <div class="ring-label">AF ${k.m}</div>
        </div>
      </div>
      <div style="font-size:18px;font-weight:900;margin-top:8px;color:${ringColor(i)};font-variant-numeric:tabular-nums">${i}%</div>
    </div>`;
  }).join('');

  // â”€â”€ Comparison table: scannable, clean â”€â”€
  const headers=['<th>Metric</th>',...NAMES.map(n=>`<th style="color:${COLORS[n]}">${n}</th>`),'<th>Team</th>','<th>MÃ¥l</th>'].join('');
  const metrics=[
    {l:'KT',k:'KT',bk:'KT',tV:tKT,tM:tBud.KT},
    {l:'SS',k:'SS',bk:'SS',tV:tSS,tM:tBud.SS},
    {l:'Samtaler',k:'Samtaler',bk:'Sam',tV:tSam,tM:tBud.Sam},
    {l:'MiM',k:'MiM',bk:'MiM',tV:tMiM,tM:tBud.MiM},
  ];
  const trows=metrics.map(m=>{
    const tPct=idx(m.tV,m.tM);
    const cells=NAMES.map(n=>{
      const v=dayData[n][m.k];
      const t=dBud[m.bk];
      const p=idx(v,t);
      const c=ringColor(p);
      const bc=barColorClass(p);
      return `<td>
        <div class="compare-val" style="color:${c}">${v}</div>
        <div class="compare-target">mÃ¥l ${t} Â· ${p}%</div>
        <div class="compare-bar-wrap"><div class="compare-bar-track"><div class="compare-bar-fill ${bc}" style="width:${Math.min(p,100)}%"></div></div></div>
      </td>`;
    }).join('');
    const tc=ringColor(tPct);
    const tbc=barColorClass(tPct);
    return `<tr><td>${m.l}</td>${cells}
      <td><div class="compare-val" style="color:${tc}">${m.tV}</div><div class="compare-target">mÃ¥l ${m.tM} Â· ${tPct}%</div>
      <div class="compare-bar-wrap"><div class="compare-bar-track"><div class="compare-bar-fill ${tbc}" style="width:${Math.min(tPct,100)}%"></div></div></div></td>
      <td style="color:var(--dimmer);font-size:13px;font-weight:700">${m.tM}</td></tr>`;
  });
  // GF row
  const allGF=NAMES.flatMap(n=>dayData[n].mimRows.filter(r=>!isNaN(r.gf)).map(r=>r.gf));
  const teamGF=allGF.length?allGF.reduce((a,b)=>a+b,0)/allGF.length:null;
  const gfCells=NAMES.map(n=>{
    const g=dayData[n].gnsGF;
    const low=dayData[n].lowGF;
    const c=g!==null?(g<1.90?'var(--yellow)':'var(--green)'):'var(--dim)';
    return `<td><div class="compare-val" style="color:${c};font-size:15px">${g!==null?g.toFixed(3):'â€”'}</div>${low>0?'<div class="compare-target" style="color:var(--yellow)">'+low+' lav</div>':''}</td>`;
  }).join('');
  trows.push(`<tr><td>GF gns</td>${gfCells}<td><div class="compare-val" style="font-size:15px;color:${teamGF!==null?(teamGF<1.90?'var(--yellow)':'var(--green)'):'var(--dim)'}">${teamGF!==null?teamGF.toFixed(3):'â€”'}</div></td><td style="color:var(--dimmer);font-size:11px">â‰¥ 1,900</td></tr>`);

  const compareEl = document.getElementById('daily-compare');
  if (compareEl) compareEl.innerHTML=`<thead><tr>${headers}</tr></thead><tbody>${trows.join('')}</tbody>`;
}

// Hall of Fame renderer
function renderMimLog(date) {
  const dateStr = fmtDate(date);
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const isToday = fmtDate(today) === dateStr;

  const todaysLogs = _mimLog.filter(entry => {
    const entryDate = new Date(entry.time);
    entryDate.setHours(0, 0, 0, 0);
    return fmtDate(entryDate) === dateStr;
  });

  if (todaysLogs.length === 0) {
    return `<div class="mim-log-section">
      <div class="mim-log-title">Dagens MiM Log ğŸ†</div>
      <div class="mim-log-empty"><span class="pulse-dot"></span>Ingen MiM endnu i dag</div>
    </div>`;
  }

  const cards = todaysLogs.map(entry => {
    const timeStr = entry.time.toLocaleTimeString('da-DK', { hour: '2-digit', minute: '2-digit' });
    let comboTag = '';
    if (entry.combo === 2) comboTag = '<span class="mim-log-tag" style="background:#f59e0b22; color:#f59e0b; font-weight: 700;">DOUBLE ğŸ¯</span>';
    else if (entry.combo === 3) comboTag = '<span class="mim-log-tag" style="background:#ef444422; color:#ef4444; font-weight: 700;">HAT-TRICK ğŸ”¥</span>';
    else if (entry.combo === 4) comboTag = '<span class="mim-log-tag" style="background:#a855f722; color:#a855f7; font-weight: 700;">RAMPAGE âš¡</span>';
    else if (entry.combo === 5) comboTag = '<span class="mim-log-tag" style="background:#ec489922; color:#ec4899; font-weight: 700;">GODLIKE ğŸ’¥</span>';
    else if (entry.combo === 6) comboTag = '<span class="mim-log-tag" style="background:linear-gradient(90deg, #f59e0b22, #ec489922, #a855f722); color:#fbbf24; font-weight: 700; border: 1px solid #f59e0b;">LEGENDARY âœ¨</span>';

    return `<div class="mim-log-card">
      <div class="mim-log-time">${timeStr}</div>
      <div class="mim-log-seller" style="color:${COLORS[entry.seller]}">${entry.seller}</div>
      <div class="mim-log-candidate"><strong>${entry.candidate}</strong></div>
      <div class="mim-log-company">${entry.company}</div>
      <div class="mim-log-meta">
        <span>GF ${isNaN(entry.gf) ? 'â€”' : entry.gf.toFixed(2)}</span>
        ${comboTag}
      </div>
    </div>`;
  }).join('');

  return `<div class="mim-log-section">
    <div class="mim-log-title">Dagens MiM Log ğŸ†</div>
    <div class="mim-log-grid">${cards}</div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARED RENDERERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildTeamKpis(w,bud,elId){
  const t={KT:NAMES.reduce((s,n)=>s+w[n].KT,0),SS:NAMES.reduce((s,n)=>s+w[n].SS,0),Sam:NAMES.reduce((s,n)=>s+w[n].Samtaler,0),MiM:NAMES.reduce((s,n)=>s+w[n].MiM,0)};
  const aGF=NAMES.flatMap(n=>w[n].mimRows.filter(r=>!isNaN(r.gf)).map(r=>r.gf));
  const aKS=NAMES.flatMap(n=>w[n].mimRows.filter(r=>!isNaN(r.ks)).map(r=>r.ks));
  t.gnsGF=aGF.length?aGF.reduce((a,b)=>a+b,0)/aGF.length:null;
  t.lowGF=NAMES.reduce((s,n)=>s+w[n].lowGF,0);
  const data=[
    {l:'KT',v:t.KT,m:bud.team.KT,sub:`MÃ¥l: ${bud.team.KT}`},
    {l:'SS',v:t.SS,m:bud.team.SS,sub:`MÃ¥l: ${bud.team.SS} Â· ${t.KT?Math.round(t.SS/t.KT*100):0}% af KT`},
    {l:'Samtaler',v:t.Sam,m:bud.team.Sam,sub:`MÃ¥l: ${bud.team.Sam}`},
    {l:'MiM',v:t.MiM,m:bud.team.MiM,sub:`MÃ¥l: ${bud.team.MiM}`},
    {l:'Gns GF',v:fmt(t.gnsGF,3),m:null,sub:`Lav: ${t.lowGF}/${aGF.length}`},
  ];
  document.getElementById(elId).innerHTML=data.map(k=>{
    const i=k.m?idx(k.v,k.m):null;
    const ih=i!==null?`<div class="kpi-idx ${idxColor(i)}">${idxBadge(i)}</div>`:'';
    return `<div class="kpi-card"><div class="kpi-label">${k.l}</div><div class="kpi-val">${k.v}</div><div class="kpi-sub">${k.sub}</div>${ih}</div>`;
  }).join('');
}

function buildSellerCards(w,wp,bud,elId){
  document.getElementById(elId).innerHTML=NAMES.map(name=>{
    const s=w[name],sp=wp?wp[name]:null,bi=bud.indiv;
    const kpis=[{l:'KT',v:s.KT,p:sp?.KT,m:bi.KT},{l:'SS',v:s.SS,p:sp?.SS,m:bi.SS},{l:'Samtaler',v:s.Samtaler,p:sp?.Samtaler,m:bi.Sam},{l:'MiM',v:s.MiM,p:sp?.MiM,m:bi.MiM}];
    const rows=kpis.map(k=>`<div class="seller-kpi"><span class="seller-kpi-label">${k.l}</span><div class="seller-kpi-right"><span class="seller-kpi-val">${k.v}/${k.m}</span>${idxBadge(idx(k.v,k.m))}${k.p!==undefined?delta(k.v,k.p):''}</div></div>`).join('');
    const gf=s.gnsGF!==null?s.gnsGF.toFixed(3):'â€”';
    const gfD=sp?deltaF(s.gnsGF,sp.gnsGF):'';
    const low=s.lowGF>0?`<span style="color:var(--yellow)">${s.lowGF}</span>`:`<span style="color:var(--green)">0</span>`;
    return `<div class="seller-card"><div class="seller-name" style="color:${COLORS[name]}">${name}</div>${rows}<hr class="divider">
      <div class="seller-kpi"><span class="seller-kpi-label">Gns GF</span><div class="seller-kpi-right"><span class="seller-kpi-val">${gf}</span>${gfD}</div></div>
      <div class="seller-kpi"><span class="seller-kpi-label">Lav GF</span><div class="seller-kpi-right">${low}</div></div></div>`;
  }).join('');
}

function buildMimDetails(w,elId,title,tElId){
  if(tElId) document.getElementById(tElId).textContent=title;
  document.getElementById(elId).innerHTML=NAMES.filter(n=>w[n].MiM>0).map(name=>{
    const rows=w[name].mimRows.map(r=>{
      const low=!isNaN(r.gf)&&r.gf<1.90;
      return `<tr><td>${r.dato.substring(0,5)}</td><td>${r.kandidat}</td><td>${r.virk}</td><td>${isNaN(r.gf)?'â€”':r.gf.toFixed(3)}${low?' <span class="tag-low">â†“ lav</span>':''}</td><td>${isNaN(r.ks)?'â€”':r.ks.toFixed(0)}</td><td style="font-size:10px;color:var(--dim)">${r.status}</td></tr>`;
    }).join('');
    return `<div class="card"><div class="card-title" style="color:${COLORS[name]}">${name} Â· ${w[name].MiM} MiM</div><table class="mim-table"><thead><tr><th>Dato</th><th>Kandidat</th><th>Virksomhed</th><th>GF</th><th>KS</th><th>Status</th></tr></thead><tbody>${rows}</tbody></table></div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UGE RENDERER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderUge(){
  const wn=parseInt(document.getElementById('week-select').value);
  const w=_trendData[wn], wp=_trendData[wn-1];
  if(!w) return;
  const bud=_budgets[wn]||{indiv:{KT:15,SS:3,Sam:13,MiM:7},team:{KT:45,SS:9,Sam:39,MiM:21}};
  const wLabel=WEEK_LABELS[wn]||`Uge ${wn}`;
  document.getElementById('period-label').textContent=wLabel+' Â· Live';
  buildTeamKpis(w,bud,'team-kpis');
  buildSellerCards(w,wp,bud,'seller-cards');
  buildMimDetails(w,'mim-details',`MiM-detaljer â€“ ${wLabel}`,'mim-details-title');

  const wks=ALL_WEEKS.filter(w=>_trendData[w]), labels=wks.map(w=>`U${w}`);
  // KT + SS combined stacked chart
  mkChart('ktChart',{type:'bar',data:{labels,datasets:[
    ...NAMES.map(n=>({label:n+' KT',data:wks.map(w=>_trendData[w][n].KT),backgroundColor:COLORS[n]+'BB',borderRadius:4,stack:'KT-'+n})),
    ...NAMES.map(n=>({label:n+' SS',data:wks.map(w=>_trendData[w][n].SS),backgroundColor:COLORS[n]+'44',borderRadius:4,stack:'KT-'+n})),
    {label:'MÃ¥l KT',type:'line',data:wks.map(w=>(_budgets[w]?.indiv.KT??15)),borderColor:COLORS.maal,borderDash:[6,3],pointRadius:3}
  ]},options:{...COP,responsive:true,plugins:{legend:{labels:{color:'#94a3b8',font:{size:9},filter:item=>!item.text.includes('SS')}}},scales:{...COP.scales,x:{stacked:false,...COP.scales.x}}}});

  mkChart('mimChart',{type:'line',data:{labels,datasets:[
    ...NAMES.map(n=>({label:n,data:wks.map(w=>_trendData[w][n].MiM),borderColor:COLORS[n],backgroundColor:COLORS[n]+'22',tension:0.3,pointRadius:5,fill:true})),
    {label:'MÃ¥l',data:wks.map(w=>(_budgets[w]?.indiv.MiM??5)),borderColor:COLORS.maal,borderDash:[6,3],pointRadius:3,tension:0}
  ]},options:{...COP,responsive:true}});

  mkChart('samChart',{type:'bar',data:{labels,datasets:[
    ...NAMES.map(n=>({label:n,data:wks.map(w=>_trendData[w][n].Samtaler),backgroundColor:COLORS[n]+'BB',borderRadius:4})),
    {label:'MÃ¥l',type:'line',data:wks.map(w=>(_budgets[w]?.indiv.Sam??13)),borderColor:COLORS.maal,borderDash:[6,3],pointRadius:3}
  ]},options:{...COP,responsive:true}});

  mkChart('gfChart',{type:'line',data:{labels,datasets:[
    ...NAMES.filter(n=>wks.some(w=>_trendData[w][n].gnsGF)).map(n=>({label:n,data:wks.map(w=>_trendData[w][n].gnsGF),borderColor:COLORS[n],tension:0.3,pointRadius:5,spanGaps:true})),
    {label:'Floor 1,90',data:wks.map(()=>1.90),borderColor:COLORS.floor,borderDash:[6,3],pointRadius:0,borderWidth:1.5}
  ]},options:{...COP,responsive:true,scales:{x:{ticks:{color:'#64748b'},grid:{color:'#151825'}},y:{min:1.82,max:2.05,ticks:{color:'#64748b',callback:v=>v.toFixed(2)},grid:{color:'#151825'}}}}});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ…NED RENDERER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMaaned(){
  const mk=document.getElementById('month-select').value;
  const [ms,me]=MONTH_RANGES[mk], wim=WEEKS_IN_MONTH[mk]||[];
  const mNames=['','Januar','Februar','Marts','April','Maj','Juni','Juli','August','September','Oktober','November','December'];
  const [mYr,mMo]=mk.split('-').map(Number);
  const ml=`${mNames[mMo]} ${mYr}`;
  document.getElementById('period-label').textContent=ml+' Â· Live';
  const sheets=['Data Input - William','Data Input - Jonas','Data Input - Andreas'];
  const mw={};
  for(let i=0;i<NAMES.length;i++) mw[NAMES[i]]=calcSellerArr(_rawData[sheets[i]],ms,me);
  const bI=wim.reduce((a,wn)=>{const b=_budgets[wn]?.indiv||{};a.KT+=b.KT||0;a.SS+=b.SS||0;a.Sam+=b.Sam||0;a.MiM+=b.MiM||0;return a;},{KT:0,SS:0,Sam:0,MiM:0});
  const mBud={indiv:bI,team:Object.fromEntries(Object.entries(bI).map(([k,v])=>[k,v*3]))};
  buildTeamKpis(mw,mBud,'month-team-kpis');
  buildSellerCards(mw,null,mBud,'month-seller-cards');
  buildMimDetails(mw,'month-mim-details',`MiM-detaljer â€“ ${ml}`,'month-mim-title');

  const wks=wim.filter(w=>_trendData[w]), labels=wks.map(w=>WEEK_LABELS[w]);
  mkChart('monthMimChart',{type:'line',data:{labels,datasets:[
    ...NAMES.map(n=>({label:n,data:wks.map(w=>_trendData[w][n].MiM),borderColor:COLORS[n],backgroundColor:COLORS[n]+'22',tension:0.3,pointRadius:5,fill:true})),
    {label:'MÃ¥l',data:wks.map(w=>(_budgets[w]?.indiv.MiM??5)),borderColor:COLORS.maal,borderDash:[6,3],pointRadius:3}
  ]},options:{...COP,responsive:true}});
  mkChart('monthKtChart',{type:'bar',data:{labels,datasets:[
    ...NAMES.map(n=>({label:n+' KT',data:wks.map(w=>_trendData[w][n].KT),backgroundColor:COLORS[n]+'BB',borderRadius:4})),
    ...NAMES.map(n=>({label:n+' SS',data:wks.map(w=>_trendData[w][n].SS),backgroundColor:COLORS[n]+'44',borderRadius:4})),
    {label:'MÃ¥l KT',type:'line',data:wks.map(w=>(_budgets[w]?.indiv.KT??15)),borderColor:COLORS.maal,borderDash:[6,3],pointRadius:3}
  ]},options:{...COP,responsive:true,plugins:{legend:{labels:{color:'#94a3b8',font:{size:9},filter:item=>!item.text.includes('SS')}}}}});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERSON RENDERER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPerson(){
  const name=document.getElementById('person-select').value;
  const sw=parseInt(document.getElementById('person-week-select').value);
  const color=COLORS[name];
  document.getElementById('period-label').textContent=`${name} Â· Personligt dashboard Â· Live`;

  const wCur=_trendData[sw]?.[name], bud=_budgets[sw]?.indiv||{KT:15,SS:3,Sam:13,MiM:7};
  const heroIdx=wCur?Math.round((wCur.KT+wCur.MiM)/(bud.KT+bud.MiM)*100):0;
  document.getElementById('person-hero').innerHTML=`<div class="person-hero">
    <div class="person-avatar" style="background:${color}22;color:${color}">${name[0]}</div>
    <div><div class="person-hero-name" style="color:${color}">${name}</div>
    <div class="person-hero-sub">U${sw} samlet index: ${idxBadge(heroIdx)}</div>
    <div class="person-hero-sub" style="margin-top:4px">${wCur?`MiM: ${wCur.MiM} Â· KT: ${wCur.KT} (SS: ${wCur.SS}) Â· Samtaler: ${wCur.Samtaler} Â· GF: ${wCur.gnsGF?.toFixed(3)||'â€”'}`:'Ingen data'}</div></div></div>`;

  const wks=ALL_WEEKS.filter(w=>_trendData[w]?.[name]);
  const headers=['<th>KPI</th>',...wks.map(w=>`<th style="color:${w===sw?color:'var(--dim)'}">${w===sw?'â–¸ ':''}U${w}</th>`),'<th>Total</th>'].join('');
  const metrics=[{k:'KT',l:'KT',b:'KT',f:false},{k:'SS',l:'SS',b:'SS',f:false},{k:'Samtaler',l:'Samtaler',b:'Sam',f:false},{k:'MiM',l:'MiM',b:'MiM',f:false},{k:'gnsGF',l:'Gns GF',b:null,f:true}];
  const trows=metrics.map(m=>{
    const vals=wks.map(w=>_trendData[w][name][m.k]);
    const total=m.f?(vals.filter(v=>v!==null).length?(vals.filter(v=>v!==null).reduce((a,b)=>a+b,0)/vals.filter(v=>v!==null).length).toFixed(3):'â€”'):vals.reduce((a,b)=>a+(b||0),0);
    const cells=wks.map((w,i)=>{
      const v=vals[i],b=_budgets[w]?.indiv[m.b];
      let disp=v===null?'â€”':(m.f?v?.toFixed(3):v);
      let badge=b&&!m.f?' '+idxBadge(idx(v,b)):'';
      return `<td${w===sw?' style="background:#1a2540"':''}>${disp}${badge}</td>`;
    }).join('');
    return `<tr><td>${m.l}</td>${cells}<td style="font-weight:800;color:${color}">${m.f?(total==='â€”'?'â€”':total):total}</td></tr>`;
  });
  document.getElementById('person-week-table').innerHTML=`<thead><tr>${headers}</tr></thead><tbody>${trows.join('')}</tbody>`;

  const labels=wks.map(w=>`U${w}`);
  mkChart('personMimChart',{type:'line',data:{labels,datasets:[
    {label:'MiM',data:wks.map(w=>_trendData[w][name].MiM),borderColor:color,backgroundColor:color+'22',tension:0.3,pointRadius:5,fill:true},
    {label:'MÃ¥l',data:wks.map(w=>_budgets[w]?.indiv.MiM??5),borderColor:COLORS.maal,borderDash:[6,3],pointRadius:3}
  ]},options:{...COP,responsive:true}});
  mkChart('personKtChart',{type:'bar',data:{labels,datasets:[
    {label:'KT',data:wks.map(w=>_trendData[w][name].KT),backgroundColor:color+'BB',borderRadius:4},
    {label:'SS',data:wks.map(w=>_trendData[w][name].SS),backgroundColor:color+'44',borderRadius:4},
    {label:'MÃ¥l',type:'line',data:wks.map(w=>_budgets[w]?.indiv.KT??15),borderColor:COLORS.maal,borderDash:[6,3],pointRadius:3}
  ]},options:{...COP,responsive:true}});
  mkChart('personGfChart',{type:'line',data:{labels,datasets:[
    {label:'GF',data:wks.map(w=>_trendData[w][name].gnsGF),borderColor:color,tension:0.3,pointRadius:5,spanGaps:true},
    {label:'Floor 1,90',data:wks.map(()=>1.90),borderColor:COLORS.floor,borderDash:[6,3],pointRadius:0,borderWidth:1.5}
  ]},options:{...COP,responsive:true,scales:{x:{ticks:{color:'#64748b'},grid:{color:'#151825'}},y:{min:1.82,max:2.05,ticks:{color:'#64748b',callback:v=>v.toFixed(2)},grid:{color:'#151825'}}}}});

  const wSel=_trendData[sw]?.[name];
  document.getElementById('person-mim-title').textContent=`MiM-detaljer â€“ ${name} Â· Uge ${sw}`;
  if(wSel&&wSel.MiM>0){
    const rows=wSel.mimRows.map(r=>{
      const low=!isNaN(r.gf)&&r.gf<1.90;
      return `<tr><td>${r.dato.substring(0,5)}</td><td>${r.kandidat}</td><td>${r.virk}</td><td>${isNaN(r.gf)?'â€”':r.gf.toFixed(3)}${low?' <span class="tag-low">â†“ lav</span>':''}</td><td>${isNaN(r.ks)?'â€”':r.ks.toFixed(0)}</td><td style="font-size:10px;color:var(--dim)">${r.status}</td></tr>`;
    }).join('');
    document.getElementById('person-mim-details').innerHTML=`<div class="card"><div class="card-title" style="color:${color}">${name} Â· ${wSel.MiM} MiM Â· Uge ${sw}</div><table class="mim-table"><thead><tr><th>Dato</th><th>Kandidat</th><th>Virksomhed</th><th>GF</th><th>KS</th><th>Status</th></tr></thead><tbody>${rows}</tbody></table></div>`;
  } else {
    document.getElementById('person-mim-details').innerHTML=`<div class="card no-data">Ingen MiM i Uge ${sw}</div>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _firstLoad = true;

// Video celebration background loads on demand (celebration_final.mp4)

// Load data and start auto-refresh
loadAll();

// Silent background refresh every 60 seconds (no UI flicker)
_autoRefreshInterval = setInterval(() => {
  silentRefresh();
}, 60000);

// Verify GitHub-hosted photos
verifyGitHubPhotos();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CYCLING DEEP SPACE BACKGROUNDS (crossfade every 30s)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function initBgCycler(){
  const bgImages = ['bg/5.jpg','bg/2.jpg','bg/1.jpg','bg/8.jpg','bg/4.jpg','bg/10.jpg','bg/12.jpg','bg/3.jpg','bg/6.jpg','bg/7.jpg','bg/9.jpg','bg/11.jpg'];
  let bgIdx = 0;
  let showingA = true;
  const elA = document.getElementById('bg-a');
  const elB = document.getElementById('bg-b');

  // Preload all images so transitions are smooth on TV stick
  bgImages.forEach(src => { const img = new Image(); img.src = src; });

  function cycleBg(){
    bgIdx = (bgIdx + 1) % bgImages.length;
    const nextSrc = "url('" + bgImages[bgIdx] + "')";
    if(showingA){
      elB.style.backgroundImage = nextSrc;
      elA.classList.replace('active','inactive');
      elB.classList.replace('inactive','active');
    } else {
      elA.style.backgroundImage = nextSrc;
      elB.classList.replace('active','inactive');
      elA.classList.replace('inactive','active');
    }
    showingA = !showingA;
  }

  setInterval(cycleBg, 30000); // Switch every 30 seconds
})();
</script>
</div><!-- /app -->
</body>
</html>
