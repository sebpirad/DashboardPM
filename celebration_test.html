<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1920,height=1080">
<title>PowerMatch — MiM Celebration</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Audiowide&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { width: 100vw; height: 100vh; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; }

/* ═══ BACKGROUND VIDEO ═══ */
#bg-video {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  object-fit: cover; z-index: 0;
}

/* ═══ CRT SCANLINES ═══ */
#scanlines {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: repeating-linear-gradient(0deg, rgba(0,0,0,0.12) 0px, rgba(0,0,0,0.12) 1px, transparent 1px, transparent 3px);
  pointer-events: none; z-index: 10; opacity: 0;
  animation: scanFadeIn 2s ease forwards 0.5s;
}
@keyframes scanFadeIn { to { opacity: 1; } }

/* ═══ CANVAS (particles) ═══ */
#particle-canvas {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  pointer-events: none; z-index: 5;
}

/* ═══ CONTENT OVERLAY ═══ */
#celebration-content {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  z-index: 20; padding: 40px;
}

/* ═══ TITLE ═══ */
.cel-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 52px; font-weight: 900; letter-spacing: 8px;
  color: #fff;
  text-shadow:
    0 0 10px #FF10F0, 0 0 20px #FF10F0, 0 0 40px #FF10F0,
    0 0 60px rgba(255,16,240,0.5), 0 0 80px rgba(255,16,240,0.3);
  opacity: 0; transform: translateY(-30px) scale(0.9);
  animation: titleReveal 1s cubic-bezier(0.34,1.56,0.64,1) forwards 0.8s;
  text-align: center;
}
@keyframes titleReveal {
  to { opacity: 1; transform: translateY(0) scale(1); }
}

/* ═══ CHROMATIC ABERRATION ON TITLE ═══ */
.cel-title::before, .cel-title::after {
  content: attr(data-text);
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  display: flex; align-items: center; justify-content: center;
}
.cel-title { position: relative; }
.cel-title::before {
  color: #FF10F0; z-index: -1;
  animation: chromaR 4s ease-in-out infinite;
}
.cel-title::after {
  color: #00F0FF; z-index: -1;
  animation: chromaB 4s ease-in-out infinite;
}
@keyframes chromaR {
  0%, 100% { transform: translate(-2px, 0); opacity: 0.7; }
  50% { transform: translate(-4px, 1px); opacity: 0.9; }
}
@keyframes chromaB {
  0%, 100% { transform: translate(2px, 0); opacity: 0.7; }
  50% { transform: translate(4px, -1px); opacity: 0.9; }
}

/* ═══ PEOPLE ROW ═══ */
.people-row {
  display: flex; align-items: flex-start; justify-content: center;
  gap: 80px; margin: 30px 0 20px 0;
}

/* ═══ PERSON CARD ═══ */
.person-card {
  display: flex; flex-direction: column; align-items: center;
  opacity: 0; transform: scale(0.7);
}
.person-card.closer {
  animation: personReveal 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards 1.5s;
}
.person-card.screener {
  animation: personReveal 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards 2.0s;
}
@keyframes personReveal {
  to { opacity: 1; transform: scale(1); }
}

/* ═══ AVATAR ═══ */
.avatar-ring {
  width: 280px; height: 280px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  position: relative; margin-bottom: 16px;
}
.avatar-ring.pink {
  box-shadow: 0 0 15px #FF10F0, 0 0 30px #FF10F0, 0 0 60px rgba(255,16,240,0.4), 0 0 90px rgba(255,16,240,0.2);
  border: 3px solid #FF10F0;
  animation: ringPulse 2s ease-in-out infinite 2s;
}
.avatar-ring.cyan {
  box-shadow: 0 0 15px #00F0FF, 0 0 30px #00F0FF, 0 0 60px rgba(0,240,255,0.4), 0 0 90px rgba(0,240,255,0.2);
  border: 3px solid #00F0FF;
  animation: ringPulseCyan 2s ease-in-out infinite 2.5s;
}
@keyframes ringPulse {
  0%, 100% { box-shadow: 0 0 15px #FF10F0, 0 0 30px #FF10F0, 0 0 60px rgba(255,16,240,0.4); }
  50% { box-shadow: 0 0 20px #FF10F0, 0 0 45px #FF10F0, 0 0 80px rgba(255,16,240,0.6); }
}
@keyframes ringPulseCyan {
  0%, 100% { box-shadow: 0 0 15px #00F0FF, 0 0 30px #00F0FF, 0 0 60px rgba(0,240,255,0.4); }
  50% { box-shadow: 0 0 20px #00F0FF, 0 0 45px #00F0FF, 0 0 80px rgba(0,240,255,0.6); }
}

.avatar-img {
  width: 268px; height: 268px; border-radius: 50%;
  object-fit: cover; display: block;
}
.avatar-fallback {
  width: 268px; height: 268px; border-radius: 50%;
  background: rgba(255,255,255,0.05);
  display: flex; align-items: center; justify-content: center;
  font-size: 120px; font-weight: 900; color: #fff;
}

/* ═══ NAME + ROLE ═══ */
.person-name {
  font-family: 'Orbitron', sans-serif;
  font-size: 28px; font-weight: 700;
  text-align: center; margin-bottom: 4px;
}
.person-name.pink {
  color: #FF10F0;
  text-shadow: 0 0 10px #FF10F0, 0 0 20px rgba(255,16,240,0.5);
}
.person-name.cyan {
  color: #00F0FF;
  text-shadow: 0 0 10px #00F0FF, 0 0 20px rgba(0,240,255,0.5);
}
.person-role {
  font-family: 'Audiowide', sans-serif;
  font-size: 13px; letter-spacing: 3px; text-transform: uppercase;
  color: rgba(255,255,255,0.5);
}

/* ═══ DATA CARDS ROW ═══ */
.data-row {
  display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;
  max-width: 900px; margin-top: 20px;
}
.data-card {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,16,240,0.2);
  border-radius: 12px; padding: 12px 24px;
  text-align: center; min-width: 140px;
  backdrop-filter: blur(8px);
  opacity: 0; transform: translateY(20px);
}
.data-card:nth-child(1) { animation: cardIn 0.5s ease forwards 2.5s; }
.data-card:nth-child(2) { animation: cardIn 0.5s ease forwards 2.7s; }
.data-card:nth-child(3) { animation: cardIn 0.5s ease forwards 2.9s; }
.data-card:nth-child(4) { animation: cardIn 0.5s ease forwards 3.1s; }
@keyframes cardIn { to { opacity: 1; transform: translateY(0); } }

.data-label {
  font-family: 'Audiowide', sans-serif;
  font-size: 10px; letter-spacing: 2px; text-transform: uppercase;
  color: #00F0FF; margin-bottom: 4px;
}
.data-value {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px; font-weight: 700; color: #fff;
}

/* ═══ GANGEFAKTOR (hero card) ═══ */
.gf-card {
  background: rgba(255,16,240,0.08);
  border: 1px solid rgba(255,16,240,0.4);
  border-radius: 16px; padding: 16px 40px;
  text-align: center; margin-top: 16px;
  opacity: 0; transform: scale(0.8);
  animation: gfReveal 0.6s cubic-bezier(0.34,1.56,0.64,1) forwards 3.3s;
}
@keyframes gfReveal { to { opacity: 1; transform: scale(1); } }
.gf-label {
  font-family: 'Audiowide', sans-serif;
  font-size: 11px; letter-spacing: 3px; text-transform: uppercase;
  color: #FF10F0; margin-bottom: 4px;
}
.gf-value {
  font-family: 'Orbitron', sans-serif;
  font-size: 42px; font-weight: 900;
  color: #FFD700;
  text-shadow: 0 0 15px rgba(255,215,0,0.6), 0 0 30px rgba(255,215,0,0.3);
}

/* ═══ GLITCH FLASH (triggered by JS) ═══ */
.glitch-flash {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  z-index: 50; pointer-events: none; opacity: 0;
  background: linear-gradient(90deg, #FF10F0 25%, transparent 25%, transparent 50%, #00F0FF 50%, #00F0FF 75%, transparent 75%);
  background-size: 8px 100%;
  mix-blend-mode: overlay;
}
.glitch-flash.active {
  animation: glitchFlash 0.15s steps(3) forwards;
}
@keyframes glitchFlash {
  0% { opacity: 0.7; transform: translateX(-5px); }
  33% { opacity: 0.5; transform: translateX(5px) skewX(2deg); }
  66% { opacity: 0.6; transform: translateX(-3px) skewX(-1deg); }
  100% { opacity: 0; transform: translateX(0); }
}

/* ═══ BEAT PULSE (applied to body via JS) ═══ */
body.beat-pulse #bg-video {
  filter: brightness(1.3) saturate(1.2);
  transition: filter 0.05s;
}
body:not(.beat-pulse) #bg-video {
  filter: brightness(1) saturate(1);
  transition: filter 0.2s;
}
</style>
</head>
<body>

<!-- Background Video -->
<video id="bg-video" autoplay muted loop playsinline preload="auto">
  <source src="celebration_bg.mp4" type="video/mp4">
</video>

<!-- CRT Scanlines -->
<div id="scanlines"></div>

<!-- Particle Canvas -->
<canvas id="particle-canvas"></canvas>

<!-- Glitch Flash Overlay -->
<div class="glitch-flash" id="glitch-flash"></div>

<!-- Content -->
<div id="celebration-content">
  <div class="cel-title" data-text="MAND I MARKEN">MAND I MARKEN</div>

  <div class="people-row">
    <!-- Closer -->
    <div class="person-card closer">
      <div class="avatar-ring pink">
        <img class="avatar-img" src="photos/william.jpg" alt="William"
             onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
        <div class="avatar-fallback" style="display:none;color:#FF10F0">W</div>
      </div>
      <div class="person-name pink">William</div>
      <div class="person-role">Closer</div>
    </div>

    <!-- Screener -->
    <div class="person-card screener">
      <div class="avatar-ring cyan">
        <img class="avatar-img" src="photos/amalie.jpg" alt="Amalie"
             onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
        <div class="avatar-fallback" style="display:none;color:#00F0FF">A</div>
      </div>
      <div class="person-name cyan">Amalie</div>
      <div class="person-role">Screener</div>
    </div>
  </div>

  <!-- Data Cards -->
  <div class="data-row">
    <div class="data-card">
      <div class="data-label">Kandidat</div>
      <div class="data-value">Martin Jensen</div>
    </div>
    <div class="data-card">
      <div class="data-label">Virksomhed</div>
      <div class="data-value">Novo Nordisk</div>
    </div>
    <div class="data-card">
      <div class="data-label">Timeløn</div>
      <div class="data-value">285 kr/t</div>
    </div>
    <div class="data-card">
      <div class="data-label">Kostpris</div>
      <div class="data-value">12.400 kr</div>
    </div>
  </div>

  <!-- Gangefaktor Hero -->
  <div class="gf-card">
    <div class="gf-label">Gangefaktor</div>
    <div class="gf-value">2.35 ✨</div>
  </div>
</div>

<script>
// ═══════════════════════════════════════
// PARTICLE SYSTEM
// ═══════════════════════════════════════
const canvas = document.getElementById('particle-canvas');
const ctx = canvas.getContext('2d');
let particles = [];
let W, H;

function resizeCanvas() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

const COLORS = ['#FF10F0', '#00F0FF', '#fff', '#FF006E', '#FFD700'];

class Particle {
  constructor(x, y, opts = {}) {
    this.x = x;
    this.y = y;
    const angle = opts.angle !== undefined ? opts.angle : Math.random() * Math.PI * 2;
    const speed = opts.speed || (Math.random() * 3 + 1);
    this.vx = Math.cos(angle) * speed;
    this.vy = Math.sin(angle) * speed;
    this.size = opts.size || (Math.random() * 2.5 + 0.5);
    this.color = opts.color || COLORS[Math.floor(Math.random() * COLORS.length)];
    this.life = 1.0;
    this.decay = opts.decay || (0.008 + Math.random() * 0.01);
    this.gravity = opts.gravity !== undefined ? opts.gravity : 0.03;
  }
  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.vy += this.gravity;
    this.life -= this.decay;
  }
  draw() {
    ctx.globalAlpha = Math.max(0, this.life);
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.fill();
  }
  alive() { return this.life > 0; }
}

function burst(x, y, count, opts = {}) {
  for (let i = 0; i < count; i++) {
    particles.push(new Particle(x, y, {
      angle: Math.random() * Math.PI * 2,
      speed: (Math.random() * 4 + 1) * (opts.power || 1),
      size: opts.size || (Math.random() * 2.5 + 0.5),
      color: opts.color || undefined,
      decay: opts.decay || undefined,
      gravity: opts.gravity !== undefined ? opts.gravity : 0.03
    }));
  }
}

// Ambient sparkle (constant, low-density)
function ambientSparkle() {
  if (Math.random() < 0.3) {
    particles.push(new Particle(
      Math.random() * W,
      Math.random() * H * 0.6,
      { speed: 0.2, size: Math.random() * 1.5 + 0.3, decay: 0.005, gravity: 0.01 }
    ));
  }
}

function animateParticles() {
  ctx.clearRect(0, 0, W, H);
  ambientSparkle();
  particles = particles.filter(p => p.alive());
  particles.forEach(p => { p.update(); p.draw(); });
  ctx.globalAlpha = 1;
  requestAnimationFrame(animateParticles);
}
animateParticles();

// ═══════════════════════════════════════
// BEAT DETECTION (Web Audio API)
// ═══════════════════════════════════════
let audioCtx, analyser, dataArray, audioSource;
let lastBeatTime = 0;
const BEAT_THRESHOLD = 140;
const BEAT_COOLDOWN = 300; // ms between beats

function initAudio(audioElement) {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 512;
  dataArray = new Uint8Array(analyser.frequencyBinCount);
  audioSource = audioCtx.createMediaElementSource(audioElement);
  audioSource.connect(analyser);
  analyser.connect(audioCtx.destination);
  detectBeat();
}

function detectBeat() {
  if (!analyser) return;
  analyser.getByteFrequencyData(dataArray);

  // Bass energy (0-10 bins = ~0-430Hz)
  let bass = 0;
  for (let i = 0; i < 10; i++) bass += dataArray[i];
  bass /= 10;

  // Treble energy (60+ bins)
  let treble = 0;
  for (let i = 60; i < dataArray.length; i++) treble += dataArray[i];
  treble /= (dataArray.length - 60);

  const now = Date.now();
  if (bass > BEAT_THRESHOLD && now - lastBeatTime > BEAT_COOLDOWN) {
    lastBeatTime = now;
    onBeat(bass);
  }

  // Subtle continuous pulse based on mid frequencies
  let mid = 0;
  for (let i = 10; i < 60; i++) mid += dataArray[i];
  mid /= 50;
  onFrequencyUpdate(bass, mid, treble);

  requestAnimationFrame(detectBeat);
}

function onBeat(intensity) {
  // 1. Brightness pulse on video
  document.body.classList.add('beat-pulse');
  setTimeout(() => document.body.classList.remove('beat-pulse'), 100);

  // 2. Particle burst from center
  const power = intensity / 180;
  burst(W / 2, H / 2, Math.floor(8 + power * 15), { power: power * 1.5 });

  // 3. Glitch flash (30% chance on strong beats)
  if (intensity > 170 && Math.random() < 0.3) {
    triggerGlitch();
  }

  // 4. Side bursts on very strong beats
  if (intensity > 180) {
    burst(0, H * 0.5, 12, { power: 2, gravity: 0.05 });
    burst(W, H * 0.5, 12, { power: 2, gravity: 0.05 });
  }
}

function onFrequencyUpdate(bass, mid, treble) {
  // Subtle scanline opacity variation based on mid frequencies
  const scanlines = document.getElementById('scanlines');
  scanlines.style.opacity = 0.6 + (mid / 255) * 0.4;
}

function triggerGlitch() {
  const el = document.getElementById('glitch-flash');
  el.classList.remove('active');
  void el.offsetWidth; // force reflow
  el.classList.add('active');
}

// ═══════════════════════════════════════
// TIMED EFFECTS (celebration timeline)
// ═══════════════════════════════════════
function startTimeline() {
  // 5s: First big burst
  setTimeout(() => burst(W/2, H/2, 40, { power: 2.5, size: 3 }), 5000);

  // 10s: Glitch at loop point + side bursts
  setTimeout(() => {
    triggerGlitch();
    burst(W*0.2, H*0.3, 25, { power: 2, color: '#FF10F0' });
    burst(W*0.8, H*0.3, 25, { power: 2, color: '#00F0FF' });
  }, 10000);

  // 15s: Rain of particles from top
  setTimeout(() => {
    for (let i = 0; i < 60; i++) {
      setTimeout(() => {
        particles.push(new Particle(Math.random() * W, -10, {
          angle: Math.PI/2 + (Math.random()-0.5)*0.5,
          speed: Math.random() * 2 + 2,
          size: Math.random() * 2 + 1,
          decay: 0.004,
          gravity: 0.08
        }));
      }, i * 30);
    }
  }, 15000);

  // 20s: Glitch at loop point
  setTimeout(() => {
    triggerGlitch();
    setTimeout(triggerGlitch, 200);
  }, 20000);

  // 25s: MASSIVE confetti burst (climax)
  setTimeout(() => {
    burst(W*0.3, H*0.8, 60, { power: 3, size: 3, gravity: -0.05 });
    burst(W*0.7, H*0.8, 60, { power: 3, size: 3, gravity: -0.05 });
    burst(W*0.5, H*0.9, 80, { power: 4, size: 3.5, gravity: -0.03 });
  }, 25000);

  // 28-32s: Continuous sparkle rain
  for (let t = 28000; t < 32000; t += 50) {
    setTimeout(() => {
      particles.push(new Particle(Math.random() * W, -10, {
        angle: Math.PI/2,
        speed: Math.random() * 3 + 2,
        size: Math.random() * 2 + 1,
        color: COLORS[Math.floor(Math.random() * COLORS.length)],
        decay: 0.003,
        gravity: 0.06
      }));
    }, t);
  }

  // 30s: Loop glitch
  setTimeout(triggerGlitch, 30000);

  // 33s: Final mega burst
  setTimeout(() => {
    burst(W/2, H/2, 100, { power: 4, size: 4, decay: 0.005 });
    triggerGlitch();
    setTimeout(triggerGlitch, 150);
    setTimeout(triggerGlitch, 300);
  }, 33000);
}

// ═══════════════════════════════════════
// AUDIO PLAYBACK (separate from video)
// ═══════════════════════════════════════
// iTunes preview URL (same as working dashboard)
const THUNDERSTRUCK_URL = 'https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview125/v4/f3/45/64/f3456422-afe5-5218-0144-6a2dd6754a2b/mzaf_8906497323614731144.plus.aac.p.m4a';

// Click anywhere to start celebration
document.addEventListener('click', function startOnce() {
  document.removeEventListener('click', startOnce);

  const audio = new Audio(THUNDERSTRUCK_URL);
  audio.crossOrigin = 'anonymous';
  audio.volume = 0.85;

  audio.play().then(() => {
    try { initAudio(audio); } catch(e) { console.log('Audio analysis not available:', e); }
    startTimeline();
  }).catch(e => {
    console.log('Audio play blocked, starting visuals only:', e);
    startTimeline();
  });
}, { once: true });
</script>
</body>
</html>
